"use strict";(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[535050],{989505:(Y,k,E)=>{E.d(k,{MP:()=>O,C9:()=>l});var O=function(I){return I.default="default",I.skypeConCore="conCore",I.mediaAgent="mediaAgent",I.CDL="CDL",I.copilot="copilot",I.maglev="maglev",I}({});const v=Object.entries(O).map(([I,L])=>({label:I,value:L})),l=new Set(["AppInfo.ClientType","Window.Type","Panel.Context","Session.TelemetryWorkerType","AppInfo.ExpIds","UserInfo.ETag","UserInfo.HostETag","UserInfo.CountryCode","Window.Type","AppInfo.Version","AppInfo.ExperienceName"])},529028:(Y,k,E)=>{E.d(k,{M:()=>ct});var O=E(989505),v=E(346296),l=E(837439),I=E(882085),L=E(574991),R=E(522842),V=E(674163),H=E(26869);const K=/[0-9a-f]{8}(-?)[0-9a-f]{4}\1[1-5][0-9a-f]{3}\1[89abAB][0-9a-f]{3}\1[0-9a-f]{12}/i,M=["00000000-0000-0000-0000-000000000000","ffffffff-ffff-ffff-ffff-ffffffffffff","00000000000000000000000000000000","ffffffffffffffffffffffffffffffff"],ee=32,_=48,c=57,b=new Set(["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","A","B","C","D","E","F"]),F=4,S=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{4})$/,f=/^[A-Za-z0-9+/]{1,22}(?:\.[0-9]+)+$/;function p(r){const e=r.trim().toLowerCase();if(e.length<ee)return!1;for(const t of M)if(e.indexOf(t)!==-1)return!0;return K.test(e)}function G(r){let e;try{e=r.includes("%")?decodeURIComponent(r):r}catch{e=r}return e}function N(r){return r.length!==1?!1:r>="A"&&r<="Z"||r>="a"&&r<="z"||r>="0"&&r<="9"?!0:r==="+"||r==="/"||r==="="}function me(r){return!(r.length===0||r.length%F!==0||!S.test(r))}function _e(r){return f.test(r)}function W(r,e,t){if(!t)return{};const i=Object.entries(t.scannerOptions||{}).find(([o])=>o===r)?.[1],u={};for(const o of e){const y=Object.entries(i||{}).find(([A])=>A===o)?.[1];y!==void 0&&(u[o]=y)}return u}function B(r){if(!(!r||r.length===0))return new RegExp(`(${r.map(e=>`(?:${e})`).join("|")})`,"i")}function ie(r){if(r.length===0)return!1;for(let e=0;e<r.length;e++){const t=r.charCodeAt(e);if(t<_||t>c)return!1}return!0}function j(r){if(r.length===0)return!1;for(const e of r)if(!b.has(e))return!1;return!0}var ge=E(878236),w=E.n(ge),de=E(351898);function g(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}class n extends de.E{shouldScan(e){return super.shouldScan(e),e.length>n.MAX_FIELD_LENGTH?!1:this.teamsShouldScan(e)}scan(e){return this.teamsScan(e)}}g(n,"MAX_FIELD_LENGTH",2e5);function s(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}class a extends n{teamsShouldScan(e){return a.AT_SYMBOLS_SHOULD_SCAN_REGEX.test(e)}teamsScan(e){a.EMAIL_MATCHER_REGEX.lastIndex=0;const i=G(e).replace(a.AT_SYMBOL_SCAN_REGEX,"@");let u;for(;(u=a.EMAIL_MATCHER_REGEX.exec(i))!==null;){const o=u[0],y=o.indexOf("@"),A=o.substring(y+1).toLowerCase();if(p(o))continue;let x=!1;for(const P of this.trustedDomains)if(A.includes(P)){x=!0;break}if(!x&&w()(o,{allow_underscores:!0}))return!0}return!1}extractEmailTrustedDomains(e){const t=W("Email",["trustedDomains"],e);return Array.isArray(t.trustedDomains)?t.trustedDomains:[]}constructor(e){super(),s(this,"trustedDomains",void 0),s(this,"identifier","Teams_Email"),this.trustedDomains=new Set(this.extractEmailTrustedDomains(e))}}s(a,"AT_SYMBOLS_SHOULD_SCAN_REGEX",new RegExp("@|_at_|%40","i")),s(a,"AT_SYMBOL_SCAN_REGEX",new RegExp("_at_","gi")),s(a,"EMAIL_MATCHER_REGEX",/\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9\u00A0-\uFFFF-]+(?:\.[a-zA-Z0-9\u00A0-\uFFFF-]+)*\.[a-zA-Z\u00A0-\uFFFF]{2,}\b/gi);function d(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}class C extends n{teamsShouldScan(e){return e.length<C.MIN_FILENAME_LENGTH||this.fileNameScannerOptions.messagePatternsToIgnoreRegex?.test(e)?!1:C.FILE_EXTENSION_REGEX.test(e)}teamsScan(e){const i=G(e).split(C.COMMON_DELIMITERS_REGEX);for(const u of i)if(this.isValidFileName(u))return!0;return!1}isValidFileName(e){const t=e.trim().toLowerCase(),i=t.length;if(i<=C.MIN_FILENAME_LENGTH||i>=C.MAX_FILENAME_LENGTH)return!1;const u=t.lastIndexOf(".");if(u<=0)return!1;const o=t.substring(u+1);if(!C.FileExtensions.has(o))return!1;const y=t.substring(0,u);return!(o==="7z"&&!Number.isNaN(Number(y))||p(y)||this.fileNameScannerOptions.fileNamePatternsToIgnoreRegex?.test(t))}extractFileNameScannerOptions(e){const t=W(this.identifier,["fileNamePatternsToIgnore","messagePatternsToIgnore"],e);return{fileNamePatternsToIgnoreRegex:Array.isArray(t.fileNamePatternsToIgnore)?B(t.fileNamePatternsToIgnore):void 0,messagePatternsToIgnoreRegex:Array.isArray(t.messagePatternsToIgnore)?B(t.messagePatternsToIgnore):void 0}}constructor(e){super(),d(this,"fileNameScannerOptions",void 0),d(this,"identifier","Teams_FileName"),this.fileNameScannerOptions=this.extractFileNameScannerOptions(e)}}d(C,"MIN_FILENAME_LENGTH",4),d(C,"MAX_FILENAME_LENGTH",255),d(C,"FileExtensions",new Set(["pdf","docx","doc","xlsx","xls","pptx","ppt","txt","rtf","odt","csv","jpeg","jpg","png","gif","svg","mp4","avi","mov","wmv","mkv","zip","rar","7z","tar","gz"])),d(C,"EXTENSION_PATTERN",`\\.(${Array.from(C.FileExtensions).join("|")})\\b`),d(C,"FILE_EXTENSION_REGEX",new RegExp(C.EXTENSION_PATTERN,"i")),d(C,"COMMON_DELIMITERS_REGEX",/[\s,;:"'<>()[\]{}|?=&/\\]/);var T=function(r){return r[r.THREE=3]="THREE",r[r.FOUR=4]="FOUR",r[r.FIVE=5]="FIVE",r[r.SIX=6]="SIX",r[r.SEVEN=7]="SEVEN",r[r.EIGHT=8]="EIGHT",r[r.NINE=9]="NINE",r[r.TEN=10]="TEN",r[r.ELEVEN=11]="ELEVEN",r[r.TWELVE=12]="TWELVE",r[r.THIRTEEN=13]="THIRTEEN",r[r.FIFTEEN=15]="FIFTEEN",r[r.SEVENTEEN=17]="SEVENTEEN",r}(T||{}),D=function(r){return r[r.ONE_DIGIT=1]="ONE_DIGIT",r[r.TWO_DIGITS=2]="TWO_DIGITS",r[r.THREE_DIGITS=3]="THREE_DIGITS",r}(D||{});const m=!0,h=!1,te={1:{countryCode:"1",countryCodeLength:1,phoneNumberLengths:[10],isRange:h},30:{countryCode:"30",countryCodeLength:2,phoneNumberLengths:[10],isRange:h},31:{countryCode:"31",countryCodeLength:2,phoneNumberLengths:[9],isRange:h},32:{countryCode:"32",countryCodeLength:2,phoneNumberLengths:[8,9],isRange:m},33:{countryCode:"33",countryCodeLength:2,phoneNumberLengths:[9],isRange:h},34:{countryCode:"34",countryCodeLength:2,phoneNumberLengths:[9],isRange:h},36:{countryCode:"36",countryCodeLength:2,phoneNumberLengths:[8,9],isRange:m},39:{countryCode:"39",countryCodeLength:2,phoneNumberLengths:[6,11],isRange:m},40:{countryCode:"40",countryCodeLength:2,phoneNumberLengths:[9],isRange:h},41:{countryCode:"41",countryCodeLength:2,phoneNumberLengths:[4,12],isRange:m},43:{countryCode:"43",countryCodeLength:2,phoneNumberLengths:[4,13],isRange:m},44:{countryCode:"44",countryCodeLength:2,phoneNumberLengths:[7,10],isRange:m},45:{countryCode:"45",countryCodeLength:2,phoneNumberLengths:[8],isRange:h},46:{countryCode:"46",countryCodeLength:2,phoneNumberLengths:[7,13],isRange:m},47:{countryCode:"47",countryCodeLength:2,phoneNumberLengths:[5,8],isRange:h},48:{countryCode:"48",countryCodeLength:2,phoneNumberLengths:[6,9],isRange:m},49:{countryCode:"49",countryCodeLength:2,phoneNumberLengths:[6,13],isRange:m},60:{countryCode:"60",countryCodeLength:2,phoneNumberLengths:[7,9],isRange:m},61:{countryCode:"61",countryCodeLength:2,phoneNumberLengths:[5,15],isRange:m},62:{countryCode:"62",countryCodeLength:2,phoneNumberLengths:[5,10],isRange:m},63:{countryCode:"63",countryCodeLength:2,phoneNumberLengths:[8,10],isRange:m},64:{countryCode:"64",countryCodeLength:2,phoneNumberLengths:[3,10],isRange:m},65:{countryCode:"65",countryCodeLength:2,phoneNumberLengths:[8,12],isRange:m},66:{countryCode:"66",countryCodeLength:2,phoneNumberLengths:[8,9],isRange:h},81:{countryCode:"81",countryCodeLength:2,phoneNumberLengths:[5,13],isRange:m},82:{countryCode:"82",countryCodeLength:2,phoneNumberLengths:[8,11],isRange:m},84:{countryCode:"84",countryCodeLength:2,phoneNumberLengths:[7,10],isRange:m},86:{countryCode:"86",countryCodeLength:2,phoneNumberLengths:[5,12],isRange:m},91:{countryCode:"91",countryCodeLength:2,phoneNumberLengths:[7,10],isRange:m},92:{countryCode:"92",countryCodeLength:2,phoneNumberLengths:[8,11],isRange:m},7:{countryCode:"7",countryCodeLength:1,phoneNumberLengths:[10],isRange:h},51:{countryCode:"51",countryCodeLength:2,phoneNumberLengths:[8,11],isRange:m},52:{countryCode:"52",countryCodeLength:2,phoneNumberLengths:[10],isRange:h},53:{countryCode:"53",countryCodeLength:2,phoneNumberLengths:[6,8],isRange:m},54:{countryCode:"54",countryCodeLength:2,phoneNumberLengths:[10],isRange:h},55:{countryCode:"55",countryCodeLength:2,phoneNumberLengths:[10],isRange:h},56:{countryCode:"56",countryCodeLength:2,phoneNumberLengths:[8,9],isRange:m},57:{countryCode:"57",countryCodeLength:2,phoneNumberLengths:[8,10],isRange:h},58:{countryCode:"58",countryCodeLength:2,phoneNumberLengths:[10],isRange:h},20:{countryCode:"20",countryCodeLength:2,phoneNumberLengths:[7,9],isRange:m},27:{countryCode:"27",countryCodeLength:2,phoneNumberLengths:[9],isRange:h},212:{countryCode:"212",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},213:{countryCode:"213",countryCodeLength:3,phoneNumberLengths:[8,9],isRange:h},216:{countryCode:"216",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},218:{countryCode:"218",countryCodeLength:3,phoneNumberLengths:[8,9],isRange:m},220:{countryCode:"220",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},221:{countryCode:"221",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},222:{countryCode:"222",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},223:{countryCode:"223",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},224:{countryCode:"224",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},225:{countryCode:"225",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},226:{countryCode:"226",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},227:{countryCode:"227",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},228:{countryCode:"228",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},229:{countryCode:"229",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},230:{countryCode:"230",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},231:{countryCode:"231",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:m},232:{countryCode:"232",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},233:{countryCode:"233",countryCodeLength:3,phoneNumberLengths:[5,9],isRange:m},234:{countryCode:"234",countryCodeLength:3,phoneNumberLengths:[7,10],isRange:m},235:{countryCode:"235",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},236:{countryCode:"236",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},237:{countryCode:"237",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},238:{countryCode:"238",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},239:{countryCode:"239",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},240:{countryCode:"240",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},241:{countryCode:"241",countryCodeLength:3,phoneNumberLengths:[6,7],isRange:h},242:{countryCode:"242",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},243:{countryCode:"243",countryCodeLength:3,phoneNumberLengths:[5,9],isRange:m},244:{countryCode:"244",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},245:{countryCode:"245",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},246:{countryCode:"246",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},247:{countryCode:"247",countryCodeLength:3,phoneNumberLengths:[4],isRange:h},248:{countryCode:"248",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},249:{countryCode:"249",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},250:{countryCode:"250",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},251:{countryCode:"251",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},252:{countryCode:"252",countryCodeLength:3,phoneNumberLengths:[5,8],isRange:m},253:{countryCode:"253",countryCodeLength:3,phoneNumberLengths:[6],isRange:h},254:{countryCode:"254",countryCodeLength:3,phoneNumberLengths:[6,10],isRange:m},255:{countryCode:"255",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},256:{countryCode:"256",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},257:{countryCode:"257",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},258:{countryCode:"258",countryCodeLength:3,phoneNumberLengths:[8,9],isRange:m},260:{countryCode:"260",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},261:{countryCode:"261",countryCodeLength:3,phoneNumberLengths:[9,10],isRange:m},262:{countryCode:"262",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},263:{countryCode:"263",countryCodeLength:3,phoneNumberLengths:[5,10],isRange:m},264:{countryCode:"264",countryCodeLength:3,phoneNumberLengths:[6,10],isRange:m},265:{countryCode:"265",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:h},266:{countryCode:"266",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},267:{countryCode:"267",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:m},268:{countryCode:"268",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:m},269:{countryCode:"269",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},290:{countryCode:"290",countryCodeLength:3,phoneNumberLengths:[4],isRange:h},291:{countryCode:"291",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},297:{countryCode:"297",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},298:{countryCode:"298",countryCodeLength:3,phoneNumberLengths:[6],isRange:h},299:{countryCode:"299",countryCodeLength:3,phoneNumberLengths:[6],isRange:h},350:{countryCode:"350",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},351:{countryCode:"351",countryCodeLength:3,phoneNumberLengths:[9,11],isRange:h},352:{countryCode:"352",countryCodeLength:3,phoneNumberLengths:[4,11],isRange:m},353:{countryCode:"353",countryCodeLength:3,phoneNumberLengths:[7,11],isRange:m},354:{countryCode:"354",countryCodeLength:3,phoneNumberLengths:[7,9],isRange:h},355:{countryCode:"355",countryCodeLength:3,phoneNumberLengths:[3,9],isRange:m},356:{countryCode:"356",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},357:{countryCode:"357",countryCodeLength:3,phoneNumberLengths:[8,11],isRange:h},358:{countryCode:"358",countryCodeLength:3,phoneNumberLengths:[5,12],isRange:m},359:{countryCode:"359",countryCodeLength:3,phoneNumberLengths:[7,9],isRange:m},370:{countryCode:"370",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},371:{countryCode:"371",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:h},372:{countryCode:"372",countryCodeLength:3,phoneNumberLengths:[7,10],isRange:m},373:{countryCode:"373",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},374:{countryCode:"374",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},375:{countryCode:"375",countryCodeLength:3,phoneNumberLengths:[9,10],isRange:m},376:{countryCode:"376",countryCodeLength:3,phoneNumberLengths:[6,8,9],isRange:h},377:{countryCode:"377",countryCodeLength:3,phoneNumberLengths:[5,9],isRange:m},378:{countryCode:"378",countryCodeLength:3,phoneNumberLengths:[6,10],isRange:m},380:{countryCode:"380",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},381:{countryCode:"381",countryCodeLength:3,phoneNumberLengths:[4,12],isRange:m},382:{countryCode:"382",countryCodeLength:3,phoneNumberLengths:[4,12],isRange:m},385:{countryCode:"385",countryCodeLength:3,phoneNumberLengths:[8,12],isRange:m},386:{countryCode:"386",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},387:{countryCode:"387",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},389:{countryCode:"389",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},420:{countryCode:"420",countryCodeLength:3,phoneNumberLengths:[4,12],isRange:m},421:{countryCode:"421",countryCodeLength:3,phoneNumberLengths:[4,9],isRange:m},423:{countryCode:"423",countryCodeLength:3,phoneNumberLengths:[7,9],isRange:m},500:{countryCode:"500",countryCodeLength:3,phoneNumberLengths:[5],isRange:h},501:{countryCode:"501",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},502:{countryCode:"502",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},503:{countryCode:"503",countryCodeLength:3,phoneNumberLengths:[7,8,11],isRange:h},504:{countryCode:"504",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},505:{countryCode:"505",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},506:{countryCode:"506",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},507:{countryCode:"507",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:h},508:{countryCode:"508",countryCodeLength:3,phoneNumberLengths:[6],isRange:h},509:{countryCode:"509",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},590:{countryCode:"590",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},591:{countryCode:"591",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},592:{countryCode:"592",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},593:{countryCode:"593",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},594:{countryCode:"594",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},595:{countryCode:"595",countryCodeLength:3,phoneNumberLengths:[5,9],isRange:m},596:{countryCode:"596",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},597:{countryCode:"597",countryCodeLength:3,phoneNumberLengths:[6,7],isRange:m},598:{countryCode:"598",countryCodeLength:3,phoneNumberLengths:[4,11],isRange:m},599:{countryCode:"599",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:m},670:{countryCode:"670",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},672:{countryCode:"672",countryCodeLength:3,phoneNumberLengths:[6],isRange:h},673:{countryCode:"673",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},674:{countryCode:"674",countryCodeLength:3,phoneNumberLengths:[4,7],isRange:h},675:{countryCode:"675",countryCodeLength:3,phoneNumberLengths:[4,11],isRange:m},676:{countryCode:"676",countryCodeLength:3,phoneNumberLengths:[5,7],isRange:h},677:{countryCode:"677",countryCodeLength:3,phoneNumberLengths:[5],isRange:h},678:{countryCode:"678",countryCodeLength:3,phoneNumberLengths:[5,7],isRange:h},679:{countryCode:"679",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},680:{countryCode:"680",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},681:{countryCode:"681",countryCodeLength:3,phoneNumberLengths:[6],isRange:h},682:{countryCode:"682",countryCodeLength:3,phoneNumberLengths:[5],isRange:h},683:{countryCode:"683",countryCodeLength:3,phoneNumberLengths:[4],isRange:h},685:{countryCode:"685",countryCodeLength:3,phoneNumberLengths:[3,7],isRange:m},686:{countryCode:"686",countryCodeLength:3,phoneNumberLengths:[5],isRange:h},687:{countryCode:"687",countryCodeLength:3,phoneNumberLengths:[6],isRange:h},688:{countryCode:"688",countryCodeLength:3,phoneNumberLengths:[5,6],isRange:h},689:{countryCode:"689",countryCodeLength:3,phoneNumberLengths:[6],isRange:h},690:{countryCode:"690",countryCodeLength:3,phoneNumberLengths:[4],isRange:h},691:{countryCode:"691",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},692:{countryCode:"692",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},800:{countryCode:"800",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},808:{countryCode:"808",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},850:{countryCode:"850",countryCodeLength:3,phoneNumberLengths:[6,17],isRange:m},852:{countryCode:"852",countryCodeLength:3,phoneNumberLengths:[8,9],isRange:m},853:{countryCode:"853",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:m},855:{countryCode:"855",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},856:{countryCode:"856",countryCodeLength:3,phoneNumberLengths:[8,10],isRange:m},870:{countryCode:"870",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},880:{countryCode:"880",countryCodeLength:3,phoneNumberLengths:[6,10],isRange:m},886:{countryCode:"886",countryCodeLength:3,phoneNumberLengths:[8,9],isRange:m},90:{countryCode:"90",countryCodeLength:2,phoneNumberLengths:[10],isRange:h},94:{countryCode:"94",countryCodeLength:2,phoneNumberLengths:[9],isRange:h},95:{countryCode:"95",countryCodeLength:2,phoneNumberLengths:[7,9],isRange:m},98:{countryCode:"98",countryCodeLength:2,phoneNumberLengths:[6,10],isRange:m},960:{countryCode:"960",countryCodeLength:3,phoneNumberLengths:[7],isRange:h},961:{countryCode:"961",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:m},962:{countryCode:"962",countryCodeLength:3,phoneNumberLengths:[5,9],isRange:m},963:{countryCode:"963",countryCodeLength:3,phoneNumberLengths:[8,10],isRange:m},964:{countryCode:"964",countryCodeLength:3,phoneNumberLengths:[8,10],isRange:m},965:{countryCode:"965",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:h},966:{countryCode:"966",countryCodeLength:3,phoneNumberLengths:[8,9],isRange:m},967:{countryCode:"967",countryCodeLength:3,phoneNumberLengths:[6,9],isRange:m},968:{countryCode:"968",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:m},971:{countryCode:"971",countryCodeLength:3,phoneNumberLengths:[8,9],isRange:m},972:{countryCode:"972",countryCodeLength:3,phoneNumberLengths:[8,9],isRange:m},973:{countryCode:"973",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},974:{countryCode:"974",countryCodeLength:3,phoneNumberLengths:[3,8],isRange:m},975:{countryCode:"975",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:m},976:{countryCode:"976",countryCodeLength:3,phoneNumberLengths:[7,8],isRange:m},977:{countryCode:"977",countryCodeLength:3,phoneNumberLengths:[8,9],isRange:m},979:{countryCode:"979",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},992:{countryCode:"992",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},993:{countryCode:"993",countryCodeLength:3,phoneNumberLengths:[8],isRange:h},994:{countryCode:"994",countryCodeLength:3,phoneNumberLengths:[8,9],isRange:m},995:{countryCode:"995",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},996:{countryCode:"996",countryCodeLength:3,phoneNumberLengths:[9],isRange:h},998:{countryCode:"998",countryCodeLength:3,phoneNumberLengths:[9],isRange:h}},ne={1:/^1555/};function oe(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}class X extends n{teamsShouldScan(e){const t=e.toLowerCase();return!(t.length<X.MINIMUM_PHONE_NUMBER_LENGTH||t.indexOf("+")===-1||this.phoneNumberScannerOptions.messagePatternsToIgnoreRegex?.test(e))}teamsScan(e){const t=G(e);return this.hasValidPhoneNumber(t)}hasValidPhoneNumber(e){let t=e.indexOf("+");for(;t!==-1;){const i=this.findPhoneNumberCandidate(e,t);if(this.isValidPhoneNumber(i.trim())&&!this.isEncodedString(e,t))return!0;t=e.indexOf("+",t+1)}return!1}isValidPhoneNumber(e){const t=this.extractPhoneNumberDigits(e);if(t.length<X.MINIMUM_PHONE_NUMBER_LENGTH||t.length>X.MAXIMUM_PHONE_NUMBER_LENGTH)return!1;const i=this.getCountryPhoneNumberLengths(t);if(i.length===0)return!1;for(const u of i)if(!this.isFakePhoneNumber(t,u)&&this.isValidPhoneNumberLength(u,t.length))return!0;return!1}isFakePhoneNumber(e,t){const i=t.countryCode;return ne[i]?ne[i].test(e):!1}isEncodedString(e,t){let i=e[t],u="";for(let o=t-1;o>=0;o--){const y=e[o];if(N(y))i=y+i;else break}for(let o=t+1;o<e.length;o++){const y=e[o];if(u.length===0&&N(y))i+=y;else if(y==="."||u.length>0&&ie(y))u+=y;else break}return i.startsWith("+")&&ie(i.slice(1))?!1:u.length>0?_e(i+u):me(i)}getCountryPhoneNumberLengths(e){const t=[];for(let i=0;i<X.MAXIMUM_COUNTRY_CODE_LENGTH;i++){const u=e.slice(0,i+1);te[u]&&t.push(te[u])}return t}extractPhoneNumberDigits(e){let t="";for(const i of e)i>="0"&&i<="9"&&(t+=i);return t}isValidPhoneNumberLength(e,t){const{countryCodeLength:i,phoneNumberLengths:u,isRange:o}=e,y=t-i;if(o){const[A,x]=u;return y>=A&&y<=x}else return u.includes(y)}findPhoneNumberCandidate(e,t){let i="";for(let u=t+1;u<e.length;u++){const o=e[u];if(o>="0"&&o<="9"||o==="-"||o===" "||o==="("||o===")")i+=o;else break}return i}extractPhoneNumberScannerOptions(e){const t=W(this.identifier,["messagePatternsToIgnore"],e);return{messagePatternsToIgnoreRegex:Array.isArray(t.messagePatternsToIgnore)?B(t.messagePatternsToIgnore):void 0}}constructor(e){super(),oe(this,"phoneNumberScannerOptions",void 0),oe(this,"identifier","Teams_PhoneNumber"),this.phoneNumberScannerOptions=this.extractPhoneNumberScannerOptions(e)}}oe(X,"MINIMUM_PHONE_NUMBER_LENGTH",7),oe(X,"MAXIMUM_PHONE_NUMBER_LENGTH",15),oe(X,"MAXIMUM_COUNTRY_CODE_LENGTH",3);function $(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}class Le extends n{teamsShouldScan(e){return e.toLowerCase().indexOf(this.MRI_LIVE_PREFIX)!==-1&&this.isMessageIgnored(e)===!1}teamsScan(e){const t=G(e).toLowerCase();let[i,u]=this.findNextMriLiveCandidate(t,0);for(;i!==void 0;){for(const o of i.split(":"))if(this.isValidMriLiveUserId(o)&&this.isIgnored(o)===!1)return!0;[i,u]=this.findNextMriLiveCandidate(t,u)}return!1}isValidMriLiveUserId(e){return e.length>=this.MIN_MRI_LIVE_ID_LENGTH&&this.isUndefinedUserId(e)===!1&&this.isCidUserId(e)===!1&&ie(e)===!1&&j(e)===!1&&this.isGuidUserId(e)===!1}isUndefinedUserId(e){return e===this.MRI_LIVE_USER_ID_UNDEFINED}isCidUserId(e){return e.startsWith(this.MRI_LIVE_USER_ID_CID_PREFIX)}isGuidUserId(e){return e.startsWith(this.MRI_LIVE_USER_ID_GUID_PREFIX)||p(e)}findNextMriLiveCandidate(e,t){const i=e.indexOf(this.MRI_LIVE_PREFIX,t);if(i===-1)return[void 0,t];let u=i+this.MRI_LIVE_PREFIX.length;for(let o=u;o<e.length&&(e[o]>="a"&&e[o]<="z"||e[o]>="0"&&e[o]<="9"||e[o]==="."||e[o]==="-"||e[o]==="_"||e[o]===":");o++)u=o;return[e.substring(i,u+1),u+1]}isIgnored(e){return this.mriLiveScannerOptions.mriLiveIdsToIgnoreRegex?.test(e)??!1}isMessageIgnored(e){return this.mriLiveScannerOptions.messagePatternsToIgnoreRegex?.test(e)??!1}extractMriLiveScannerOptions(e){const t=W(this.identifier,["messagePatternsToIgnore","mriLiveIdsToIgnore"],e);return{messagePatternsToIgnoreRegex:Array.isArray(t.messagePatternsToIgnore)?B(t.messagePatternsToIgnore):void 0,mriLiveIdsToIgnoreRegex:Array.isArray(t.mriLiveIdsToIgnore)?B(t.mriLiveIdsToIgnore):void 0}}constructor(e){super(),$(this,"MRI_LIVE_PREFIX","8:live:"),$(this,"MRI_LIVE_USER_ID_CID_PREFIX",".cid."),$(this,"MRI_LIVE_USER_ID_GUID_PREFIX","guid"),$(this,"MRI_LIVE_USER_ID_UNDEFINED","undefined"),$(this,"MIN_MRI_LIVE_ID_LENGTH",5),$(this,"mriLiveScannerOptions",void 0),$(this,"identifier","Teams_MriLive"),this.mriLiveScannerOptions=this.extractMriLiveScannerOptions(e)}}function Q(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}class Te extends n{teamsShouldScan(e){if(this.scannerOptions.messagePatternsToIgnoreRegex?.test(e))return!1;for(const t of this.meetingAndChannelMetadataKeys)if(e.indexOf(t)!==-1)return!0;return!1}teamsScan(e){const t=G(e);for(const i of this.meetingAndChannelMetadataKeys){const u=this.meetingAndChannelMetadataParams[i].jsonParam,o=this.meetingAndChannelMetadataParams[i].queryParam;if(this.hasUnsafeMetadataValue(t,u)||this.hasUnsafeMetadataValue(t,o))return!0}return!1}toJSONParam(e){return`"${e}":`}toQueryParam(e){return`${e}=`}hasUnsafeMetadataValue(e,t){let i=e.indexOf(t);for(;i!==-1;){if(!this.isMetadataSafe(e,i,t))return!0;i=e.indexOf(t,i+1)}return!1}isMetadataSafe(e,t,i){const u=t+i.length,o=Math.min(e.length,u+this.LONGEST_SAFE_VALUE_LENGTH_DOUBLE_QUOTED),y=e.slice(u,o).trim().toLowerCase();if(y.length===0||y.startsWith(this.JSON_EMPTY_VALUE))return!0;const A=y.startsWith('"');for(const x of this.SAFE_VALUES){const P=A?`"${x}`:x;if(y.startsWith(P))return!0}return!1}extractMeetingsAndChannelScannerOptions(e){const t=W(this.identifier,["messagePatternsToIgnore","meetingAndChannelParamToScan"],e);return{messagePatternsToIgnoreRegex:Array.isArray(t.messagePatternsToIgnore)?B(t.messagePatternsToIgnore):void 0,meetingAndChannelParamToScan:Array.isArray(t.meetingAndChannelParamToScan)?t.meetingAndChannelParamToScan:void 0}}constructor(e){super(),Q(this,"SAFE_VALUES",[",","&","<pii>","pii","file-euii","email-euii","ssn-euii","creditCard-euii","true","false","null","undefined"]),Q(this,"LONGEST_SAFE_VALUE_LENGTH_DOUBLE_QUOTED",18),Q(this,"JSON_EMPTY_VALUE",'""'),Q(this,"meetingAndChannelMetadataKeys",new Set),Q(this,"meetingAndChannelMetadataParams",{}),Q(this,"scannerOptions",void 0),Q(this,"identifier","Teams_MeetingAndChannelsMetadata"),this.scannerOptions=this.extractMeetingsAndChannelScannerOptions(e),this.scannerOptions.meetingAndChannelParamToScan&&this.scannerOptions.meetingAndChannelParamToScan.forEach(t=>{this.meetingAndChannelMetadataKeys.add(t)}),this.meetingAndChannelMetadataKeys.forEach(t=>{this.meetingAndChannelMetadataParams[t]={jsonParam:this.toJSONParam(t),queryParam:this.toQueryParam(t)}})}}function se(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}class Se extends n{teamsShouldScan(e){return this.urlScannerOptions.messagePatternsToIgnoreRegex?.test(e)?!1:e.indexOf(this.HTTPS_SCHEME)!==-1&&this.hasSPOUrlKeywords(e)}teamsScan(e){const t=this.urlScannerOptions.spoUrlPatternsToIgnoreRegex,i=e.toLowerCase();let u=i.indexOf(this.HTTPS_SCHEME);for(;u!==-1;){const o=this.extractSPOUrl(i,u);if(o!==void 0&&o.length>0){if(t&&t.test(o)){u=i.indexOf(this.HTTPS_SCHEME,u+this.HTTPS_SCHEME.length);continue}if(!this.isSPOUrlSafe(o))return!0}u=i.indexOf(this.HTTPS_SCHEME,u+this.HTTPS_SCHEME.length)}return!1}extractSPOUrl(e,t){let i="";const u=t+this.HTTPS_SCHEME.length;for(let o=u;o<e.length;o++){const y=e.charAt(o),A=e.charCodeAt(o);if(!this.URL_CHARACTER_TERMINATORS.has(y)&&A>=this.ASCII_CONTROL_CHARACTERS_MIN_RANGE)i+=y;else break}return this.hasSPOUrlKeywords(i)?i:void 0}hasSPOUrlKeywords(e){return e.indexOf(this.SHAREPOINT_URI_PATTERN)!==-1}isSPOUrlSafe(e){const t=e.indexOf("/");if(t===-1||t===e.length-1)return!0;const i=e.slice(t+1);return!!(this.urlScannerOptions.spoUrlParamsToIgnoreRegex&&this.urlScannerOptions.spoUrlParamsToIgnoreRegex.test(i))}extractUrlScannerOptions(e){const t=W(this.identifier,["messagePatternsToIgnore","spoUrlPatternsToIgnore","spoUrlParamsToIgnore"],e);return{messagePatternsToIgnoreRegex:Array.isArray(t.messagePatternsToIgnore)?B(t.messagePatternsToIgnore):void 0,spoUrlPatternsToIgnoreRegex:Array.isArray(t.spoUrlPatternsToIgnore)?B(t.spoUrlPatternsToIgnore):void 0,spoUrlParamsToIgnoreRegex:Array.isArray(t.spoUrlParamsToIgnore)?B(t.spoUrlParamsToIgnore):void 0}}constructor(e){super(),se(this,"HTTPS_SCHEME","https://"),se(this,"SHAREPOINT_URI_PATTERN",".sharepoint"),se(this,"URL_CHARACTER_TERMINATORS",new Set([" ",'"',"'","<",">","`","^",",",";","@","#","(",")","{","}","[","]","|","\\"])),se(this,"ASCII_CONTROL_CHARACTERS_MIN_RANGE",32),se(this,"urlScannerOptions",void 0),se(this,"identifier","Teams_OdspUri"),this.urlScannerOptions=this.extractUrlScannerOptions(e)}}const Ie=["augloop.office","whiteboard.office","forms.office","outlook.office","cdn.office","staffhub.office","delve.office","support.office","tasks.office","viva.office","api.office","products.office","loki.office","config.office","measure.office","lifecycle.office","staffhub.office","ecs.office","officescripting","officeapps","officeppe","substrate","suite.office"],Ee=["teams.microsoft","ic3.teams","teams.cdn","teams.cloud","teams.office","teams.internal.office","trouter.teams","teams.core","teams.events","registrar.events","teams.live","eaglex"],ve=["microsoft365","microsofticm","microsoftonline","microsoftstream","microsoftpersonalcontent","cloud.microsoft","flow.microsoft","static.microsoft","microsoft.com","microsoft.visualstudio"],be=["skype.com","skype.net","broker.skype"],Ne=["1drv","onedrive"],Re=["windows.com","windows.net"],Me=["yammer"],Oe=["o365filtering","o365.com","o365cloud.com"],Pe=["outlook"],Ae=["api.cortana"],xe=["onenote"],De=["powerapps","powerplatform"],Ue=["azure"],Fe=["graph.microsoft"],We=["arc.microsoft","arc.msn"],Ge=["reactjs.org"],ke=["w3.org"],Be=["login.live","docs.live","apis.live"],we=["glassjar"],Ve=["eng.ms","aka.ms"],He=["meetingintelligence"],ze=["sharepoint"];function re(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}class Xe extends n{teamsShouldScan(e){return this.urlScannerOptions.messagePatternsToIgnoreRegex?.test(e)?!1:e.indexOf(this.HTTP_SCHEME)!==-1||e.indexOf(this.HTTPS_SCHEME)!==-1}teamsScan(e){const t=this.urlScannerOptions.urlPatternsToIgnoreRegex,i=e.toLowerCase();let u=this.getNextUrlSchemeIndex(i,0);for(;u!==-1;){const o=this.extractUrlDomain(i,u);if(!this.validateUrl(o)){u=this.getNextUrlSchemeIndex(i,u);continue}if(t&&t.test(o)){u=this.getNextUrlSchemeIndex(i,u);continue}if(!this.isSafeURL(o))return!0;u=this.getNextUrlSchemeIndex(i,u)}return!1}validateUrl(e){if(!e||e.length<this.MIN_URL_LENGTH)return!1;const t=e.lastIndexOf(".");return!(t===-1||t+this.MIN_TLD_LENGTH>=e.length)}getNextUrlSchemeIndex(e,t){const i=e.indexOf(this.HTTPS_SCHEME,t),u=e.indexOf(this.HTTP_SCHEME,t);return i===-1&&u===-1?-1:u===-1?i+this.HTTPS_SCHEME.length:i===-1?u+this.HTTP_SCHEME.length:i<u?i+this.HTTPS_SCHEME.length:u+this.HTTP_SCHEME.length}extractUrlDomain(e,t){let i="";for(let u=t;u<e.length;u++){const o=e[u];if(o>="a"&&o<="z"||o>="0"&&o<="9"||o==="-"||o===".")i+=o;else break}return i}isSafeURL(e){return this.matchSafeUrlDomainFragments(e,["teams"],Ee)||this.matchSafeUrlDomainFragments(e,["microsoft"],ve)||this.matchSafeUrlDomainFragments(e,["office"],Ie)||this.matchSafeUrlDomainFragments(e,["skype"],be)||this.matchSafeUrlDomainFragments(e,["1drv","onedrive"],Ne)||this.matchSafeUrlDomainFragments(e,["windows"],Re)||this.matchSafeUrlDomainFragments(e,["onenote"],xe)||this.matchSafeUrlDomainFragments(e,["azure"],Ue)||this.matchSafeUrlDomainFragments(e,["yammer"],Me)||this.matchSafeUrlDomainFragments(e,["o365"],Oe)||this.matchSafeUrlDomainFragments(e,["outlook"],Pe)||this.matchSafeUrlDomainFragments(e,["cortana"],Ae)||this.matchSafeUrlDomainFragments(e,["graph"],Fe)||this.matchSafeUrlDomainFragments(e,["arc"],We)||this.matchSafeUrlDomainFragments(e,["power"],De)||this.matchSafeUrlDomainFragments(e,["react"],Ge)||this.matchSafeUrlDomainFragments(e,["w3"],ke)||this.matchSafeUrlDomainFragments(e,["live"],Be)||this.matchSafeUrlDomainFragments(e,["glassjar"],we)||this.matchSafeUrlDomainFragments(e,["ms"],Ve)||this.matchSafeUrlDomainFragments(e,["msai"],He)||this.matchSafeUrlDomainFragments(e,["sharepoint"],ze)}matchSafeUrlDomainFragments(e,t,i){let u=!1;for(const o of t)if(e.indexOf(o)!==-1){u=!0;break}if(u){for(const o of i)if(e.indexOf(o)!==-1)return!0}return!1}extractUrlScannerOptions(e){const t=W(this.identifier,["messagePatternsToIgnore","urlPatternsToIgnore"],e);return{messagePatternsToIgnoreRegex:Array.isArray(t.messagePatternsToIgnore)?B(t.messagePatternsToIgnore):void 0,urlPatternsToIgnoreRegex:Array.isArray(t.urlPatternsToIgnore)?B(t.urlPatternsToIgnore):void 0}}constructor(e){super(),re(this,"MIN_URL_LENGTH",4),re(this,"MIN_TLD_LENGTH",2),re(this,"HTTP_SCHEME","http://"),re(this,"HTTPS_SCHEME","https://"),re(this,"urlScannerOptions",void 0),re(this,"identifier","Teams_Url"),this.urlScannerOptions=this.extractUrlScannerOptions(e)}}function ce(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var Ke=function(r){return r.TeamsEmail="Teams_Email",r.TeamsFileName="Teams_FileName",r.TeamsPhoneNumber="Teams_PhoneNumber",r.TeamsMriLive="Teams_MriLive",r.TeamsMeetingAndChannelMetadata="Teams_MeetingAndChannelsMetadata",r.TeamsUrl="Teams_Url",r.TeamsOdspUri="Teams_OdspUri",r}(Ke||{});class je{createLogSanitizerPluginInstance(e,t){if(!this.logSanitizerPluginInstanceMap[e]){const i=new R.R;i.setEnabled(t),this.logSanitizerPluginInstanceMap[e]=i}return this.logSanitizerPluginInstanceMap[e]}updateLogSanitizerPluginConfigInstances(e,t){const i=this.toISanitizerConfig(t,!0);Object.values(this.logSanitizerPluginInstanceMap).forEach(u=>{u.setEnabled(!1),u.updateSanitizer(i),u.setEnabled(e)})}checkAndUpdateExcludedTelemetryFields(e,t){const i=this.logSanitizerPluginInstanceMap[e]?.sanitizer,u=t.data;if(i&&u){for(const o in u)if(Object.prototype.hasOwnProperty.call(u,o)){const y=o.split(".")[0];this.excludedTelemetryObjects.has(y)&&i.addExclusion(o)}}}toISanitizerConfig(e,t){(t||Object.keys(this.teamsScannerIds).length===0)&&this.initializeTeamsScanners(e);const i=[],u=[],o=(0,V.Q)();for(const y of e?.sanitize||[])y in H.B&&u.push(H.B[y]),y in this.teamsScannerIds&&u.push(this.teamsScannerIds[y]);for(const y of e?.warn||[])y in H.B&&i.push(H.B[y]),y in this.teamsScannerIds&&i.push(this.teamsScannerIds[y]);return{...o,...e,excludedPaths:this.excludedTelemetryFields,warn:i,sanitize:u}}initializeTeamsScanners(e){this.teamsScannerIds={Teams_Email:()=>new a(e),Teams_FileName:()=>new C(e),Teams_PhoneNumber:()=>new X(e),Teams_MriLive:()=>new Le(e),Teams_MeetingAndChannelsMetadata:()=>new Te(e),Teams_Url:()=>new Xe(e),Teams_OdspUri:()=>new Se(e)}}constructor(){ce(this,"logSanitizerPluginInstanceMap",{}),ce(this,"teamsScannerIds",{}),ce(this,"excludedTelemetryObjects",new Set(["UserInfo","AppInfo","DeviceInfo","CommonSchema","CPUInfo","PipelineInfo","Panel","Session","Window","Action","Module","Browser","EventInfo"])),ce(this,"excludedTelemetryFields",["logLevel","logger","appId","baseData","userAgent","ext","timings","time","baseType","name","operationType","primaryUserInfoTenantId","mtmaAccounts","clientVersion"])}}function U(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}const Je=3,Ze=1,Ce=6e4,Ye="EventInfo.CapturedOffline",$e="EventInfo.TelemetryPaused",pe={maxStorageSizeInBytes:20971520,storageKeyPrefix:"Teams:telemetry-instrumentation-offline-storage",minPersistenceLevel:2,eventsLimitInMem:null,inMemoMaxTime:15e3,inStorageMaxTime:1008e4,maxRetry:1,maxBatchsize:63e3,maxSentBatchInterval:15e3};var Qe=function(r){return r[r.ONLINE=1]="ONLINE",r[r.OFFLINE=2]="OFFLINE",r}(Qe||{}),qe=function(r){return r[r.INTERNAL=0]="INTERNAL",r[r.SERVER=1]="SERVER",r[r.CLIENT=2]="CLIENT",r[r.PRODUCER=3]="PRODUCER",r[r.CONSUMER=4]="CONSUMER",r}(qe||{});const et=6e5,tt=["admin","Admin","ADMIN","administrator","Administrator","ADMINISTRATOR","automation","Automation","AUTOMATION","client","Client","CLIENT","limited","Limited","LIMITED","office","Office","OFFICE","services","Services","SERVICES","user","User","USER"],le={browserVer:"DeviceInfo.BrowserVersion",browserName:"DeviceInfo.BrowserName"},ae={traceId:"EventInfo.TraceId",spanId:"EventInfo.SpanId",parentId:"EventInfo.ParentSpanId",success:"Scenario.Status",delta:"delta"};class nt{initialize(e){this.initParams=e,this.pauseWatchdogMaxMs=e.pauseWatchdogMs??Ce,this.sharedConfig={instrumentationKey:e.appTokens.default,endpointUrl:e.oneDsCollectorUrl,propertyConfiguration:{populateBrowserInfo:!0,populateOperatingSystemInfo:!0,sessionAsGuid:!0},channelConfiguration:{payloadPreprocessor:e.enableCompression?(t,i)=>{this.gzipPayload(t,i)}:void 0,eventsLimitInMem:e.eventsLimitInMem,autoFlushEventsLimit:e.eventsLimitInMem*e.autoFlushPercent,ignoreMc1Ms0CookieProcessing:!0,enableCompoundKey:!0},maxMessageLimit:0},this.sharedConfig.extensionConfig||(this.sharedConfig.extensionConfig=[]),this.sharedConfig.extensionConfig[this.offlineChannel.identifier]={providers:[Je],...pe,...this.initParams.applicationInsightsOfflineSettings},this.offlineMinPersistenceLevel=this.initParams.applicationInsightsOfflineSettings?.minPersistenceLevel||this.offlineMinPersistenceLevel,this.oneDsManager.create(this.sharedConfig),this.oneDsManager.getPostChannel().core.stopPollingInternalLogs?.(),this.oneDsManager.addSharedPlugin(this.offlineChannel),this.updateSDKWithOfflineTelemetry(!!this.initParams.enableOfflineTelemetry),this.initParams.enablePrivacyGuard&&this._initializePrivacyGuard(),this.contextManager.contextCallbacks["DeviceInfo.OsVersion"]=this.onOsVersion.bind(this)}updateSDKWithPrivacyGuard(e){e?this._initializePrivacyGuard():this._stopPrivacyGuard()}updateSDKWithLogSanitizer(e,t){this.logSanitizerPluginManager.updateLogSanitizerPluginConfigInstances(e,t)}updateSDKWithOfflineTelemetry(e){this.oneDsManager.getPostChannel().core.getPlugin(this.offlineChannel.identifier).setEnabled(e)}setPrivacyGuardSensitiveInformation(e){const t=e.userNames,i=e.upns;if(t){const u=new Set(this.privacyGuardCommonContext.UserNames||[]);t.filter(o=>o).forEach(o=>{u.add(o)}),this.privacyGuardCommonContext.UserNames=Array.from(u)}if(i){const u=new Set(this.privacyGuardCommonContext.UserAliases||[]);i.filter(o=>o).forEach(o=>{const y=o.split("@")[0];y&&u.add(y)}),this.privacyGuardCommonContext.UserAliases=Array.from(u)}Object.keys(this.privacyGuardMap).forEach(u=>{const o=this.privacyGuardMap[u];o&&o.updateCommonContext(this.privacyGuardCommonContext)})}start(){this.resume()}stop(){this.pause(),this.pauseWatchdogTimer&&(clearTimeout(this.pauseWatchdogTimer),this.pauseWatchdogTimer=void 0)}setOnlineState(e){this.offlineChannel.getOfflineListener().setOnlineState(e?1:2),this.isOnline=e,this.recomputeEffectiveOnline()}setForceTelemetryPaused(e){this.forceTelemetryPaused=e,e?(this.pauseWatchdogTimer&&clearTimeout(this.pauseWatchdogTimer),this.pauseWatchdogTimer=setTimeout(()=>{if(this.forceTelemetryPaused){this.forceTelemetryPaused=!1,this.recomputeEffectiveOnline();try{const t=this.oneDsLoggers[this.initParams?.defaultLoggerName??O.MP.default],i={name:"loggingns",baseType:"telemetry_instrumentation_telemetry_pause_handler",time:new Date().toISOString(),data:{watchdogMs:{value:this.pauseWatchdogMaxMs},message:"[OneDsTransporter] watchdog timeout triggered"},persistence:2};t.track(i)}catch{}}},this.pauseWatchdogMaxMs)):this.pauseWatchdogTimer&&(clearTimeout(this.pauseWatchdogTimer),this.pauseWatchdogTimer=void 0),this.recomputeEffectiveOnline()}setTelemetryPaused(e){this.setForceTelemetryPaused(e)}pause(){this.oneDsManager.getPostChannel().pause(),this.statusParams.active=!1,this.traceIdTimer&&clearInterval(this.traceIdTimer)}resume(){this.oneDsManager.getPostChannel().resume(),this.statusParams.active=!0}setDeviceAuthToken(e){this.initParams?.enableLoggingGlobalDeviceId&&this.oneDsManager.getPostChannel().setMsaAuthTicket(e)}flush(e,t){const i=()=>{e.postMessage("flushed")};this.oneDsManager.getPostChannel().flush(!!t,i)}flushForReinit(e){const t=()=>{e.postMessage("flushedForReinit"),this.pause()};this.oneDsManager.getPostChannel().flush(!1,t)}createNewLogger(e,t){if(e&&(this.statusParams.firstPartyLoggerTokens[e]=""),!(!e||!t)&&this.initParams){const i=this.logSanitizerPluginManager.createLogSanitizerPluginInstance(e,this.initParams.enableLogSanitizer??!1),u=this.setupPrivacyGuard(t),o={extensionConfig:{[i.identifier]:this.logSanitizerPluginManager.toISanitizerConfig(this.initParams.logSanitizerConfig),[u.identifier]:{useEventFieldPrefix:!0,useAbsoluteFieldName:!0}}},y=this.oneDsManager.newInst(t,o,[i,u]);if(!y)return;y.stopPollingInternalLogs(),this.oneDsLoggers[e]=y,this.statusParams.firstPartyLoggerTokens[e]=t;const A="MSTeamsFix15SecondsProfile";this.oneDsManager.getPostChannel()._loadTransmitProfiles({[A]:[this.initParams.normalPrioritySendTimeInSecs,this.initParams.highPrioritySendTimeInSecs]}),this.oneDsManager.getPostChannel()._setTransmitProfile(A),this._handleSDKContextOverridesAtInit(y),this.canDrainNow()&&this.drainNow()}}logEvent(e,t,i){if(!e||!t)return;const u=this.oneDsLoggers[e];if(!u)return;const o=t.properties,y={logger:{value:e}};for(const he in o)if(Object.prototype.hasOwnProperty.call(o,he)){const ue=o[he],lt={value:ue.value,kind:ue.pii};y[he]=lt}const x=new Date(t.timestamp).toISOString(),P={name:t.name,baseType:t.eventType,time:x,data:{...y,...this.contextManager.getContext(e,i)}},Z=this.initParams?.eventPersistence?.[t.name]??{};let q=Ze;if(this.forceTelemetryPaused&&P.data&&(P.data[$e]={value:"true"}),this.forceTelemetryPaused?q=2:Z?.[t.eventType]!==void 0?q=Z[t.eventType]:Z?.["*"]!==void 0&&(q=Z["*"]),P.persistence=q,!this.isOnline&&P.data&&P.persistence>=this.offlineMinPersistenceLevel&&(P.data[Ye]={value:"true"}),this.initParams?.enableDistributedTracing&&this.initParams?.distributedTracingAllowList?.includes(t.eventType)&&P.data){P.ext={...P.ext,dt:{traceId:P.data?.[ae.traceId]?.value,spanId:P.data?.[ae.spanId]?.value}};const he=P.data?.[ae.delta]?.value||0,ue=new Date(new Date(x).getTime()-he);P.baseData={...P.baseData,name:{value:t.eventType},kind:{value:2},time:{value:ue.toISOString()},parentId:P.data?.[ae.parentId]?.value,success:P.data?.[ae.success]?.value==="success"?{value:!0}:{value:!1}},this.createSpansFromSteps(u,P,ue)}this.logSanitizerPluginManager.checkAndUpdateExcludedTelemetryFields(e,P),u.track(P)}createNewSecondPartyLogger(e,t,i=!1){const u=this.logSanitizerPluginManager.createLogSanitizerPluginInstance(e,this.initParams?.enableLogSanitizer??!1),o=this.setupPrivacyGuard(t),y={extensionConfig:{[u.identifier]:this.logSanitizerPluginManager.toISanitizerConfig(this.initParams?.logSanitizerConfig),[o.identifier]:{useEventFieldPrefix:!0,useAbsoluteFieldName:!0}}},A=this.oneDsManager.newInst(t,y,[u,o]);A.stopPollingInternalLogs(),this.secondPartyLoggers[e]={logger:A,useTeamsContext:i},this.statusParams.secondPartyLoggerTokens[e]=t}logSecondPartyEvent(e,t){if(!e||!t)return;const i=this.secondPartyLoggers[e];i&&(i.useTeamsContext&&(t.data={...t.data,...this.contextManager.commonSchemaContextMap}),this.logSanitizerPluginManager.checkAndUpdateExcludedTelemetryFields(e,t),i.logger.track(t))}logSession(e,t){t.sessionId&&this.oneDsManager.getPropertyManager().getPropertiesContext().session.setId(t.sessionId)}gzipPayload(e,t){e.data=(0,L.gzip)(e.data),e.urlString+="&content-encoding=gzip",t(e)}handleSDKContextOverrides(e,t,i){if(!this.initParams?.enableSDKContextOverrides||!Object.values(le).includes(e))return;const u=i?[i]:Object.values(this.oneDsLoggers),o=t||this.contextManager.getContext(void 0)[e]?.value.toString();if(o)switch(e){case le.browserVer:{u.forEach(y=>y.getOverridePropertyManager().getOverrideContext().web.setBrowserVer(o));break}case le.browserName:{u.forEach(y=>y.getOverridePropertyManager().getOverrideContext().web.setBrowser(o));break}}}canDrainNow(){return this.isOnline&&!this.forceTelemetryPaused&&this.statusParams.active}drainNow(){try{this.oneDsManager.getPostChannel().flush(!0)}catch{}}setupPrivacyGuard(e){if(!this.privacyGuardMap[e]){const t=new l.j;t.updateCommonContext({IgnoredNameParts:tt,...this.privacyGuardCommonContext}),this.privacyGuardMap[e]=t}return this.initParams?.enablePrivacyGuard&&this.privacyGuardMap[e].setEnabled(!0),this.privacyGuardMap[e]}recomputeEffectiveOnline(){const e=this.isOnline&&!this.forceTelemetryPaused&&this.statusParams.active;this._lastEffectiveOnline!==e&&(this._lastEffectiveOnline=e,e&&(this.resume(),this.drainNow(),this.pauseWatchdogTimer&&(clearTimeout(this.pauseWatchdogTimer),this.pauseWatchdogTimer=void 0)))}_handleSDKContextOverridesAtInit(e){Object.values(le).forEach(t=>this.handleSDKContextOverrides(t,this.contextManager.getContext(void 0)[t]?.value,e))}_initializePrivacyGuard(){this.intervalId||(this.intervalId=setInterval(()=>{Object.keys(this.privacyGuardMap).forEach(e=>{this.privacyGuardMap[e].sendSummaryEvent(!0)})},et))}_stopPrivacyGuard(){this.intervalId&&clearInterval(this.intervalId),Object.keys(this.privacyGuardMap).forEach(e=>{this.privacyGuardMap[e].setEnabled(!1)})}onOsVersion(e,t){this.oneDsManager.getPropertyManager().getPropertiesContext().os.ver=t}createSpansFromSteps(e,t,i){const u=t.data?.["Scenario.Steps"];if(u&&u.value){let o;const y=JSON.parse(u.value);if(y.length===1)return;y.forEach(A=>{const x=JSON.parse(JSON.stringify(t)),P=`${t.baseType}_${A["Scenario.Step"]}`;let Z=i,q=A.delta;o&&(Z=new Date(new Date(Z).getTime()+o.delta),q=A.delta-o.delta),x.baseType=P,x.data={...x.data,"Scenario.Name":{value:P},delta:{value:q},elapsed:{value:A.elapsed}},x.baseData={...x.baseData,name:{value:P},time:{value:Z.toISOString()},parentId:t?.ext?.dt.spanId},x.ext={...x.ext,dt:{...x.ext?.dt,spanId:this.generateSpanId()}},delete x?.data?.["Scenario.Steps"],o=A,e.track(x)})}}generateSpanId(){const i=new Uint8Array(8);return typeof globalThis.crypto<"u"&&globalThis.crypto.getRandomValues(i),Array.from(i).map(u=>u.toString(16).padStart(2,"0")).join("")}constructor(e){U(this,"contextManager",void 0),U(this,"oneDsLoggers",void 0),U(this,"secondPartyLoggers",void 0),U(this,"oneDsManager",void 0),U(this,"offlineChannel",void 0),U(this,"sharedConfig",void 0),U(this,"logSanitizerPluginManager",void 0),U(this,"privacyGuardMap",void 0),U(this,"privacyGuardCommonContext",void 0),U(this,"intervalId",void 0),U(this,"isOnline",void 0),U(this,"offlineMinPersistenceLevel",void 0),U(this,"traceIdTimer",void 0),U(this,"forceTelemetryPaused",void 0),U(this,"pauseWatchdogTimer",void 0),U(this,"pauseWatchdogMaxMs",void 0),U(this,"_lastEffectiveOnline",void 0),U(this,"initParams",void 0),U(this,"statusParams",void 0),this.contextManager=e,this.oneDsLoggers={},this.secondPartyLoggers={},this.oneDsManager=new v.D,this.offlineChannel=new I.f,this.sharedConfig={},this.logSanitizerPluginManager=new je,this.privacyGuardMap={},this.privacyGuardCommonContext={},this.isOnline=!0,this.offlineMinPersistenceLevel=pe.minPersistenceLevel,this.forceTelemetryPaused=!1,this.pauseWatchdogMaxMs=Ce,this.statusParams={active:!0,firstPartyLoggerTokens:{},secondPartyLoggerTokens:{}}}}var st=E(927350);function J(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}const rt={"appinfo.id":"ext.app.id","appinfo.env":"ext.app.env","appinfo.version":"ext.app.ver","appinfo.versionnew":"ext.app.ver","appinfo.language":"ext.app.locale","userinfo.language":"ext.user.locale","userinfo.timezone":"ext.location.tz","userinfo.id":"ext.user.id","userinfo.tenantid":"ext.user.tenantid","deviceinfo.id":"ext.device.localid","deviceinfo.make":"ext.device.make","deviceinfo.model":"ext.device.model","deviceinfo.networktype":"ext.net.type","deviceinfo.browsername":"ext.web.browser","deviceinfo.browserversion":"ext.web.browserversion"},it=new Set(["userinfo.tenantid","primaryuserinfotenantid"]),ot=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i,fe="UserInfo.Id",ye="AppInfo.ExpIds";class at{setEnableMTMA(e){this.enableMTMA=e}setEnableMergedExpIds(e){this.enableMergedExpIds=e}setUserId(e){const t={value:e,kind:void 0};this.enableMTMA?this.setContext({key:fe,value:e,userContextId:e},void 0):(this.contextMap[fe]=t,this._setToCommonSchemaPropMap(fe,t))}setPrimaryUser(e){this.primaryUser||(this.primaryUser=e,this.userContextMap[e]||(this.userContextMap[e]={}))}logOutUser(e){this.enableMTMA&&(this.userContextMap[e]={})}shouldSetGuidContextEntry(e,t){const i=(e||"").toLowerCase().trim();if(!it.has(i))return!0;const u=String(t??"").trim();return ot.test(u)}setContext(e,t){const i={value:e.value};this.shouldSetGuidContextEntry(e.key,e.value)&&(this.enableMTMA?(e.userContextId?(this.userContextMap[e.userContextId]||(this.userContextMap[e.userContextId]={}),this.userContextMap[e.userContextId][e.key]=i):this.contextMap[e.key]=i,this._setToCommonSchemaPropMap(e.key,i)):(this.contextMap[e.key]=i,this._setToCommonSchemaPropMap(e.key,i)),e.key in this.contextCallbacks&&this.contextCallbacks[e.key](e.key,e.value),t?.handleSDKContextOverrides(e.key,e.value))}getContext(e,t){return t=t&&t.length>0?t:this.primaryUser,{...this._getMainContext(t),...this._getLoggerContext(e,t)}}setLoggerContext(e,t){if(e.logger&&(this.loggerContextMap[e.logger]||(this.loggerContextMap[e.logger]={baseMap:{},userMap:{}}),t.has(e.key))){const i={value:e.value};e.key===ye&&this.enableMergedExpIds&&(i.value=this._joinExpIds(this.contextMap[ye]?.value,e.value)),this.enableMTMA?e.userContextId?(this.loggerContextMap[e.logger].userMap[e.userContextId]||(this.loggerContextMap[e.logger].userMap[e.userContextId]={}),this.loggerContextMap[e.logger].userMap[e.userContextId][e.key]=i):this.loggerContextMap[e.logger].baseMap[e.key]=i:this.loggerContextMap[e.logger].baseMap[e.key]=i,e.key in this.contextCallbacks&&this.contextCallbacks[e.key](e.key,e.value)}}_getLoggerContext(e,t){return e?(this.loggerContextMap[e]||(this.loggerContextMap[e]={baseMap:{},userMap:{}}),{...this.loggerContextMap[e].baseMap,...t&&t.length&&this.enableMTMA?this.loggerContextMap[e].userMap[t]:{}}):{}}_getMainContext(e){return{...this.contextMap,...e&&e.length&&this.enableMTMA?this.userContextMap[e]:{}}}_joinExpIds(e,t){return!e&&!t?"":!e&&t?t:e&&!t?e:Array.from(new Set([...e.split(","),...t.split(",")])).join(",")}_setToCommonSchemaPropMap(e,t){const i=rt[e.toLowerCase()];i&&(this.commonSchemaContextMap[i]=t)}constructor(){J(this,"contextMap",{}),J(this,"userContextMap",{}),J(this,"loggerContextMap",{}),J(this,"enableMTMA",!1),J(this,"enableMergedExpIds",!1),J(this,"contextCallbacks",{}),J(this,"commonSchemaContextMap",{}),J(this,"primaryUser","")}}var ht=E(610921);function z(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}const ut="defaultOneDsUrl";class ct{initialize(e){if(e)this.router=e;else throw new Error("WebWorkerRouter did not exist.");this._registerMessageHandlers(e)}setupFirstPartyRouter(e,t){e.registerMessageHandler("initialize",i=>{this.telemetryTransport?e.postMessage("workerInitialized"):this.delayedTransportCallbacks.push(()=>e.postMessage("workerInitialized"))}),e.registerMessageHandler("newLogger",i=>{this.telemetryTransport?.createNewLogger(i.key,i.value),this.firstPartyLoggers[i.key]=i.value}),e.registerMessageHandler("logEvent",i=>{this.telemetryTransport?.logEvent(i.key,i.value,i.userContextId)}),e.registerMessageHandler("setContext",i=>{const{contextFilter:u}=t;this.contextManager.setLoggerContext(i,u)})}Verbose(e){this.router&&this.router.postMessage("verbose",e)}Error(e){this.router&&this.router.postMessage("error",e)}Info(e){this.router&&this.router.postMessage("info",e)}channelPortMessageHandlers(e,t,i,u){switch(e){case"initialize":{this.telemetryTransport?t.postMessage({name:"workerInitialized",params:void 0}):this.delayedTransportCallbacks.push(()=>t.postMessage({name:"workerInitialized",params:void 0}));break}case"batch":{for(const o of u)o&&o.name&&this.channelPortMessageHandlers(o.name,t,i,o?.params);t.postMessage({name:"batchDone",params:void 0});break}case"logEvent":{if(u){const o=u;this.telemetryTransport?.logEvent(i??o.key,o.value,o.userContextId)}break}case"setContext":{u&&(u.logger=i,this.contextManager.setLoggerContext(u,O.C9));break}case"newLogger":{if(u){const o=u;this.telemetryTransport?.createNewLogger(o.key,o.value),this.firstPartyLoggers[o.key]=o.value}break}default:}}registerMessageChannelPort(e,t){const i=u=>{this.channelPortMessageHandlers(u.data.operation,e,u.data.channel,u.data.params)};e.onmessage=i.bind(this),this.liteExperienceChannels[t]=e}_registerMessageHandlers(e){e.registerMessageHandler("initialize",t=>{this.initTelemetryTransport(t),e.postMessage("workerInitialized")}),e.registerMessageHandler("start",()=>{this.telemetryTransport?.start()}),e.registerMessageHandler("stop",()=>{this.telemetryTransport?.stop()}),e.registerMessageHandler("flush",t=>{this.telemetryTransport?.flush(e,t?.isAsync)}),e.registerMessageHandler("flushForReinit",t=>{this.reinitTelemetryTransport(t,e)}),e.registerMessageHandler("newLogger",t=>{this.telemetryTransport?.createNewLogger(t.key,t.value),this.firstPartyLoggers[t.key]=t.value}),e.registerMessageHandler("logEvent",t=>{this.telemetryTransport?.logEvent(t.key,t.value,t.userContextId)}),e.registerMessageHandler("newSecondPartyOneDsLogger",t=>{this.createSecondPartyLogger(t.key,t.value.ingestionToken,t.value.useTeamsContext)}),e.registerMessageHandler("setupChannelMessengerPort",t=>{this.registerMessageChannelPort(t.port,t.identifier)}),e.registerMessageHandler("teardownChannelMessengerPort",t=>{delete this.liteExperienceChannels[t.identifier]}),e.registerMessageHandler("setPrimaryUser",t=>{this.contextManager.setPrimaryUser(t.userContextId)}),e.registerMessageHandler("logSecondPartyEvent",t=>{this.telemetryTransport?.logSecondPartyEvent(t.key,t.value)}),e.registerMessageHandler("logSession",t=>{this.telemetryTransport?.logSession(e,t)}),e.registerMessageHandler("setUserId",t=>{this.contextManager.setUserId(t)}),e.registerMessageHandler("setDeviceAuthToken",t=>{this.telemetryTransport?.setDeviceAuthToken(t)}),e.registerMessageHandler("setContext",t=>{this.contextManager.setContext(t,this.telemetryTransport)}),e.registerMessageHandler("setPrivacyGuardUserInfo",t=>{this.enableOneDsSdk&&this.telemetryTransport?.setPrivacyGuardSensitiveInformation(t)}),e.registerMessageHandler("updateSDKWithPrivacyGuard",t=>{this.enableOneDsSdk&&this.telemetryTransport?.updateSDKWithPrivacyGuard(t)}),e.registerMessageHandler("updateSDKWithLogSanitizer",t=>{this.enableOneDsSdk&&this.telemetryTransport?.updateSDKWithLogSanitizer(t.flag,t.logSanitizerConfig)}),e.registerMessageHandler("updateSDKWithOfflineTelemetry",t=>{this.enableOneDsSdk&&this.telemetryTransport?.updateSDKWithOfflineTelemetry(t)}),e.registerMessageHandler("logOutUser",t=>{this.contextManager?.logOutUser(t)}),e.registerMessageHandler("setPausedTelemetryPersistenceLevel",()=>{this.telemetryTransport?.setForceTelemetryPaused(!0)}),e.registerMessageHandler("resetPausedTelemetryPersistenceLevel",()=>{this.telemetryTransport?.setForceTelemetryPaused(!1)}),e.registerMessageHandler("setOnlineState",async t=>{this.telemetryTransport?.setOnlineState(t)}),e.registerMessageHandler("startPerformanceObserver",async()=>{this.performanceObserver||(this.performanceObserver=new PerformanceObserver(this.performanceObserverCallback),this.performanceObserver.observe({type:"resource"}))}),e.registerMessageHandler("stopPerformanceObserver",async()=>{this.performanceObserver&&(this.performanceObserver.disconnect(),this.performanceObserver=void 0)})}createSecondPartyLogger(e,t,i){this.secondPartyLoggers[e]={token:t,useTeamsContext:i},this.telemetryTransport?.createNewSecondPartyLogger(e,t,i)}reinitTelemetryTransport(e,t){this.telemetryTransport?.flushForReinit(t);const i=e.oneDsCollectorUrl||"",u=this.existingTransports[i];u?u.statusParams.active?this.telemetryTransport=u:(this.telemetryTransport=u,Object.keys(this.firstPartyLoggers).forEach(o=>{(!this.telemetryTransport?.statusParams.firstPartyLoggerTokens[o]||this.telemetryTransport?.statusParams.firstPartyLoggerTokens[o]!==this.firstPartyLoggers[o])&&this.telemetryTransport?.createNewLogger(O.MP[o],this.firstPartyLoggers[o])}),Object.keys(this.secondPartyLoggers).forEach(o=>{(!this.telemetryTransport?.statusParams.secondPartyLoggerTokens[o]||this.telemetryTransport?.statusParams.secondPartyLoggerTokens[o]!==this.secondPartyLoggers[o].token)&&this.telemetryTransport?.createNewSecondPartyLogger(o,this.secondPartyLoggers[o].token,this.secondPartyLoggers[o].useTeamsContext)}),this.telemetryTransport.start()):(this.initTelemetryTransport(e),this.telemetryTransport?.createNewLogger(e.defaultLoggerName||O.MP.default,e.appTokens.default),this.telemetryTransport?.logSession(t,{name:e.defaultLoggerName||O.MP.default,state:st.Yj.STARTED,sessionId:e.sessionId,sessionStartTime:e.sessionStartTime}),Object.keys(this.firstPartyLoggers).forEach(o=>{this.telemetryTransport?.createNewLogger(O.MP[o],this.firstPartyLoggers[o])}),Object.keys(this.secondPartyLoggers).forEach(o=>{this.telemetryTransport?.createNewSecondPartyLogger(o,this.secondPartyLoggers[o].token,this.secondPartyLoggers[o].useTeamsContext)}))}initTelemetryTransport(e){this.contextManager.setEnableMTMA(!!e.enableMTMA),this.contextManager.setEnableMergedExpIds(!!e.enableMergedExpIds),e.enableDebugTrace?e.config.log=this:e.config.log=void 0,this.enableOneDsSdk=!0,this.telemetryTransport=new nt(this.contextManager),this.existingTransports[e.oneDsCollectorUrl||ut]=this.telemetryTransport,this.telemetryTransport.initialize(e),this.delayedTransportCallbacks.length>0&&(this.delayedTransportCallbacks.forEach(t=>{t()}),this.delayedTransportCallbacks=[]),Object.keys(this.liteExperienceChannels).forEach(t=>this.liteExperienceChannels[t].postMessage("workerInitialized"))}constructor(){z(this,"telemetryTransport",void 0),z(this,"router",void 0),z(this,"enableOneDsSdk",!1),z(this,"existingTransports",{}),z(this,"secondPartyLoggers",{}),z(this,"firstPartyLoggers",{}),z(this,"delayedTransportCallbacks",[]),z(this,"contextManager",new at),z(this,"liteExperienceChannels",{}),z(this,"performanceObserver",void 0),z(this,"performanceObserverCallback",e=>{this.router?.postMessage("onPerformanceObserverEntries",JSON.stringify(e.getEntries()))}),this.contextManager.setContext({key:"Telemetry.WorkerId",value:(0,ht.v4)()})}}},685406:(Y,k,E)=>{E.d(k,{k:()=>v});function O(l,I,L){return I in l?Object.defineProperty(l,I,{value:L,enumerable:!0,configurable:!0,writable:!0}):l[I]=L,l}class v{registerMessageHandler(I,L){if(this.messageHandlers[I]){console.warn(`message handler already registered for - ${I}`);return}this.messageHandlers[I]=L}unregisterMessageHandler(I){delete this.messageHandlers[I]}constructor(){O(this,"messageHandlers",{}),this.registerMessageHandler("batch",I=>{for(const L of I)if(L&&L.name){const R=this.messageHandlers[L.name];R&&R(L.params)}this.postMessage("batchDone")})}}},915485:(Y,k,E)=>{E.d(k,{I:()=>O});var O=function(l){return l[l.BT_STOP=0]="BT_STOP",l[l.BT_STOP_BASE=1]="BT_STOP_BASE",l[l.BT_BOOL=2]="BT_BOOL",l[l.BT_UINT8=3]="BT_UINT8",l[l.BT_UINT16=4]="BT_UINT16",l[l.BT_UINT32=5]="BT_UINT32",l[l.BT_UINT64=6]="BT_UINT64",l[l.BT_FLOAT=7]="BT_FLOAT",l[l.BT_DOUBLE=8]="BT_DOUBLE",l[l.BT_STRING=9]="BT_STRING",l[l.BT_STRUCT=10]="BT_STRUCT",l[l.BT_LIST=11]="BT_LIST",l[l.BT_SET=12]="BT_SET",l[l.BT_MAP=13]="BT_MAP",l[l.BT_INT8=14]="BT_INT8",l[l.BT_INT16=15]="BT_INT16",l[l.BT_INT32=16]="BT_INT32",l[l.BT_INT64=17]="BT_INT64",l[l.BT_WSTRING=18]="BT_WSTRING",l[l.BT_UNAVAILABLE=127]="BT_UNAVAILABLE",l}({}),v=function(l){return l[l.MARSHALED_PROTOCOL=0]="MARSHALED_PROTOCOL",l[l.MAFIA_PROTOCOL=17997]="MAFIA_PROTOCOL",l[l.COMPACT_PROTOCOL=16963]="COMPACT_PROTOCOL",l[l.JSON_PROTOCOL=21322]="JSON_PROTOCOL",l[l.PRETTY_JSON_PROTOCOL=20554]="PRETTY_JSON_PROTOCOL",l[l.SIMPLE_PROTOCOL=20563]="SIMPLE_PROTOCOL",l}({})},456226:(Y,k,E)=>{E.d(k,{T:()=>l});function O(I,L,R){return L in I?Object.defineProperty(I,L,{value:R,enumerable:!0,configurable:!0,writable:!0}):I[L]=R,I}class v{Add(L){for(var R=0;R<this._buffer.length&&this._buffer[R]!=L;++R);R==this._buffer.length&&this._buffer.push(L)}Count(){return this._buffer.length}GetBuffer(){return this._buffer}constructor(){O(this,"_buffer",[])}}class l{Add(L,R){this._getIndex(L)==-1&&this._buffer.push({Key:L,Value:R})}AddOrReplace(L,R){var V=this._getIndex(L);V>=0?this._buffer[V]={Key:L,Value:R}:this._buffer.push({Key:L,Value:R})}Remove(L){var R=this._getIndex(L);R>=0&&this._buffer.splice(R,1)}Count(){return this._buffer.length}GetBuffer(){return this._buffer}ContainsKey(L){return this._getIndex(L)>=0}Get(L){var R=this._getIndex(L);return R>=0?this._buffer[R].Value:null}_getIndex(L){for(var R=0,V=-1;R<this._buffer.length;++R)if(this._buffer[R].Key==L){V=R;break}return V}constructor(){O(this,"_buffer",[])}}},515617:(Y,k,E)=>{E.d(k,{CG:()=>H,DA:()=>K,wN:()=>M,WJ:()=>ee,Aw:()=>c,E1:()=>b});var O=E(915485),v=E(5298);function l(S,f,p){return f in S?Object.defineProperty(S,f,{value:p,enumerable:!0,configurable:!0,writable:!0}):S[f]=p,S}class I{constructor(f,p){l(this,"Type",void 0),l(this,"Id",void 0),this.Type=f,this.Id=p}}class L{constructor(f,p){l(this,"ElementType",void 0),l(this,"Size",void 0),this.ElementType=f,this.Size=p}}class R{constructor(f,p,G){l(this,"KeyType",void 0),l(this,"ValueType",void 0),l(this,"Size",void 0),this.KeyType=f,this.ValueType=p,this.Size=G}}class V{}class H{Equals(f){var p=new H(f);return this.low==p.low&&this.high==p.high}constructor(f){l(this,"low",0),l(this,"high",0),this.low=parseInt(f),this.low<0&&(this.high=-1)}}class K{Equals(f){var p=new K(f);return this.low==p.low&&this.high==p.high}constructor(f){l(this,"low",0),l(this,"high",0),this.low=parseInt(f)}}class M{static ToByte(f){return this.ToUInt8(f)}static ToInt8(f){var p=(f&128)<<24>>24;return f&127|p}static ToInt16(f){var p=(f&32768)<<16>>16;return f&32767|p}static ToInt32(f){var p=f&2147483648;return f&2147483647|p}static ToUInt8(f){return f&255}static ToUInt16(f){return f&65535}static ToUInt32(f){return f&4294967295}}class ee{constructor(f){l(this,"Message",void 0),this.Message=f}}class _{constructor(){l(this,"Key",void 0),l(this,"Value",void 0)}}class c{static IsDataViewSupport(){return typeof ArrayBuffer<"u"&&typeof DataView<"u"}}class b{WriteBlob(f){this._stream.Write(f,0,f.length)}WriteBool(f){this._stream.WriteByte(f?1:0)}WriteContainerBegin(f,p){this.WriteUInt8(p),this.WriteUInt32(f)}WriteMapContainerBegin(f,p,G){this.WriteUInt8(p),this.WriteUInt8(G),this.WriteUInt32(f)}WriteContainerEnd(){}WriteDouble(f){var p=v.__.GetBytes(f);this._stream.Write(p,0,p.length)}WriteFloat(f){var p=v.nt.GetBytes(f);this._stream.Write(p,0,p.length)}WriteFieldBegin(f,p,G){p<=5?this._stream.WriteByte(f|p<<5):p<=255?(this._stream.WriteByte(f|6<<5),this._stream.WriteByte(p)):(this._stream.WriteByte(f|7<<5),this._stream.WriteByte(p),this._stream.WriteByte(p>>8))}WriteFieldEnd(){}WriteFieldOmitted(f,p,G){}WriteInt16(f){f=v.bD.EncodeZigzag16(f),this.WriteUInt16(f)}WriteInt32(f){f=v.bD.EncodeZigzag32(f),this.WriteUInt32(f)}WriteInt64(f){this.WriteUInt64(v.bD.EncodeZigzag64(f))}WriteInt8(f){this._stream.WriteByte(M.ToInt8(f))}WriteString(f){if(f=="")this.WriteUInt32(0);else{var p=v.YE.GetBytes(f);this.WriteUInt32(p.length),this._stream.Write(p,0,p.length)}}WriteStructBegin(f,p){}WriteStructEnd(f){this.WriteUInt8(f?O.I.BT_STOP_BASE:O.I.BT_STOP)}WriteUInt16(f){var p=v.Hs.GetBytes(M.ToUInt16(f));this._stream.Write(p,0,p.length)}WriteUInt32(f){var p=v.Hs.GetBytes(M.ToUInt32(f));this._stream.Write(p,0,p.length)}WriteUInt64(f){var p=v.NO.GetBytes(f);this._stream.Write(p,0,p.length)}WriteUInt8(f){this._stream.WriteByte(M.ToUInt8(f))}WriteWString(f){this.WriteUInt32(f.length);for(var p=0;p<f.length;++p){var G=f.charCodeAt(p);this._stream.WriteByte(G),this._stream.WriteByte(G>>>8)}}constructor(f){l(this,"_stream",void 0),this._stream=f}}class F{}},352744:(Y,k,E)=>{E.d(k,{Wp:()=>I,f0:()=>V,LY:()=>M,D2:()=>ee});var O=E(515617),v=E(915485);function l(_,c,b){return c in _?Object.defineProperty(_,c,{value:b,enumerable:!0,configurable:!0,writable:!0}):_[c]=b,_}class I{static GetGuid(){var c=function(){return Math.floor((1+Math.random())*65536).toString(16).substring(1,5)};return[c(),c(),"-",c(),"-",c(),"-",c(),"-",c(),c(),c()].join("")}static GetTimeStamp(){var c=new Date().getTime(),b=new O.CG("0");return b.low=c&4294967295,b.high=Math.floor(c/4294967296),b}static GetTimeStampWithValue(c){var b=new O.CG("0");return b.low=c&4294967295,b.high=Math.floor(c/4294967296),b}}var L=function(_){return _[_.NotSet=0]="NotSet",_[_.Event=1]="Event",_[_.PerformanceCounter=2]="PerformanceCounter",_[_.Anomaly=3]="Anomaly",_[_.Prediction=4]="Prediction",_[_.TraceLog=5]="TraceLog",_[_.EventSourceLog=6]="EventSourceLog",_[_.HttpLog=7]="HttpLog",_[_.PerformanceCounterAzure=8]="PerformanceCounterAzure",_[_.PerformanceCounterGfs=9]="PerformanceCounterGfs",_}({}),R=function(_){return _[_.NotSet=0]="NotSet",_[_.O365=1]="O365",_[_.SkypeBI=2]="SkypeBI",_[_.SkypeData=3]="SkypeData",_}({}),V=function(_){return _[_.NotSet=0]="NotSet",_[_.DistinguishedName=1]="DistinguishedName",_[_.GenericData=2]="GenericData",_[_.IPV4Address=3]="IPV4Address",_[_.IPv6Address=4]="IPv6Address",_[_.MailSubject=5]="MailSubject",_[_.PhoneNumber=6]="PhoneNumber",_[_.QueryString=7]="QueryString",_[_.SipAddress=8]="SipAddress",_[_.SmtpAddress=9]="SmtpAddress",_[_.Identity=10]="Identity",_[_.Uri=11]="Uri",_[_.Fqdn=12]="Fqdn",_[_.IPV4AddressLegacy=13]="IPV4AddressLegacy",_[_.FilePath=14]="FilePath",_}({});class H{Write(c){this.WriteImpl(c,!1)}WriteImpl(c,b){c.WriteStructBegin(null,b),this.ScrubType!=0?(c.WriteFieldBegin(BondDataType.BT_INT32,1,null),c.WriteInt32(this.ScrubType),c.WriteFieldEnd()):c.WriteFieldOmitted(BondDataType.BT_INT32,1,null),this.Kind!=0?(c.WriteFieldBegin(BondDataType.BT_INT32,2,null),c.WriteInt32(this.Kind),c.WriteFieldEnd()):c.WriteFieldOmitted(BondDataType.BT_INT32,2,null),this.RawContent!=""?(c.WriteFieldBegin(BondDataType.BT_STRING,3,null),c.WriteString(this.RawContent),c.WriteFieldEnd()):c.WriteFieldOmitted(BondDataType.BT_STRING,3,null),c.WriteStructEnd(b)}Read(c){this.ReadImpl(c,!1)}ReadImpl(c,b){}constructor(){l(this,"ScrubType",0),l(this,"Kind",0),l(this,"RawContent","")}}class K{AddOrReplacePII(c,b,F){var S=new H;S.RawContent=b,S.Kind=F,S.ScrubType=1,this.PIIExtensions.AddOrReplace(c,S)}Write(c){this.WriteImpl(c,!1)}WriteImpl(c,b){if(c.WriteStructBegin(null,b),this.Id!=""?(c.WriteFieldBegin(BondDataType.BT_STRING,1,null),c.WriteString(this.Id),c.WriteFieldEnd()):c.WriteFieldOmitted(BondDataType.BT_STRING,1,null),this.Timestamp.Equals("0")?c.WriteFieldOmitted(BondDataType.BT_INT64,3,null):(c.WriteFieldBegin(BondDataType.BT_INT64,3,null),c.WriteInt64(this.Timestamp),c.WriteFieldEnd()),this.Type!=""?(c.WriteFieldBegin(BondDataType.BT_STRING,5,null),c.WriteString(this.Type),c.WriteFieldEnd()):c.WriteFieldOmitted(BondDataType.BT_STRING,5,null),this.EventType!=""?(c.WriteFieldBegin(BondDataType.BT_STRING,6,null),c.WriteString(this.EventType),c.WriteFieldEnd()):c.WriteFieldOmitted(BondDataType.BT_STRING,6,null),this.Extension.Count()){c.WriteFieldBegin(BondDataType.BT_MAP,13,null),c.WriteMapContainerBegin(this.Extension.Count(),BondDataType.BT_STRING,BondDataType.BT_STRING);for(var F=0;F<this.Extension.GetBuffer().length;++F)c.WriteString(this.Extension.GetBuffer()[F].Key),c.WriteString(this.Extension.GetBuffer()[F].Value);c.WriteContainerEnd(),c.WriteFieldEnd()}else c.WriteFieldOmitted(BondDataType.BT_MAP,13,null);if(this.RecordType!=0?(c.WriteFieldBegin(BondDataType.BT_INT32,24,null),c.WriteInt32(this.RecordType),c.WriteFieldEnd()):c.WriteFieldOmitted(BondDataType.BT_INT32,24,null),this.PIIExtensions.Count()){c.WriteFieldBegin(BondDataType.BT_MAP,30,null),c.WriteMapContainerBegin(this.PIIExtensions.Count(),BondDataType.BT_STRING,BondDataType.BT_STRUCT);for(var S=0;S<this.PIIExtensions.GetBuffer().length;++S)c.WriteString(this.PIIExtensions.GetBuffer()[S].Key),this.PIIExtensions.GetBuffer()[S].Value.WriteImpl(c,!1);c.WriteContainerEnd(),c.WriteFieldEnd()}else c.WriteFieldOmitted(BondDataType.BT_MAP,30,null);c.WriteStructEnd(b)}Read(c){this.ReadImpl(c,!1)}ReadImpl(c,b){}constructor(){l(this,"Id",I.GetGuid()),l(this,"Timestamp",I.GetTimeStamp()),l(this,"Type",""),l(this,"EventType",""),l(this,"Extension",new Map),l(this,"RecordType",0),l(this,"PIIExtensions",new Map)}}class M{Write(c){this.WriteImpl(c,!1)}WriteImpl(c,b){if(c.WriteStructBegin(null,b),this.Source!=""?(c.WriteFieldBegin(v.I.BT_STRING,2,null),c.WriteString(this.Source),c.WriteFieldEnd()):c.WriteFieldOmitted(v.I.BT_STRING,2,null),this.DataPackageId!=""?(c.WriteFieldBegin(v.I.BT_STRING,5,null),c.WriteString(this.DataPackageId),c.WriteFieldEnd()):c.WriteFieldOmitted(v.I.BT_STRING,5,null),this.Timestamp.Equals("0")?c.WriteFieldOmitted(v.I.BT_INT64,6,null):(c.WriteFieldBegin(v.I.BT_INT64,6,null),c.WriteInt64(this.Timestamp),c.WriteFieldEnd()),this.Records.length){c.WriteFieldBegin(v.I.BT_LIST,8,null),c.WriteContainerBegin(this.Records.length,v.I.BT_STRUCT);for(var F=0;F<this.Records.length;++F)this.Records[F].WriteImpl(c,!1);c.WriteContainerEnd(),c.WriteFieldEnd()}else c.WriteFieldOmitted(v.I.BT_LIST,8,null);c.WriteStructEnd(b)}Read(c){this.ReadImpl(c,!1)}ReadImpl(c,b){}constructor(){l(this,"Source",""),l(this,"DataPackageId",""),l(this,"Timestamp",new O.CG("0")),l(this,"Records",[])}}class ee{Write(c){this.WriteImpl(c,!1)}WriteImpl(c,b){if(c.WriteStructBegin(null,b),this.DataPackages.length){c.WriteFieldBegin(v.I.BT_LIST,1,null),c.WriteContainerBegin(this.DataPackages.length,v.I.BT_STRUCT);for(var F=0;F<this.DataPackages.length;++F)this.DataPackages[F].WriteImpl(c,!1);c.WriteContainerEnd(),c.WriteFieldEnd()}else c.WriteFieldOmitted(v.I.BT_LIST,1,null);this.RequestRetryCount!=0?(c.WriteFieldBegin(v.I.BT_INT32,2,null),c.WriteInt32(this.RequestRetryCount),c.WriteFieldEnd()):c.WriteFieldOmitted(v.I.BT_INT32,2,null),c.WriteStructEnd(b)}Read(c){this.ReadImpl(c,!1)}ReadImpl(c,b){}constructor(){l(this,"DataPackages",[]),l(this,"RequestRetryCount",0)}}},641767:(Y,k,E)=>{E.d(k,{go:()=>B,zC:()=>ie});var O=E(352744);function v(g,n,s){return n in g?Object.defineProperty(g,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):g[n]=s,g}class l{static IsSafariOrFirefox(){return l._isSafariOrFirefox===null&&l._DetectBrowser(),l._isSafariOrFirefox}static ajax(n){var s=l._createConnection();if(n.headers){var a="qsp=true";for(var d in n.headers)a+="&",a+=encodeURIComponent(d),a+="=",a+=encodeURIComponent(n.headers[d]);n.url.indexOf("?")<0?n.url+="?":n.url+="&",n.url+=a}s.open(n.type,n.url),n.complete&&(s.onload=()=>{typeof s.status>"u"&&(s.status=200),n.complete(s)},s.ontimeout=()=>{typeof s.status>"u"&&(s.status=500),n.complete(s)},s.onerror=()=>{n.complete(s)}),s.send(n.data)}static keys(n){if(Object.keys)return Object.keys(n);var s=[];for(var a in n)n.hasOwnProperty(a)&&s.push(a);return s}static IsUsingXDomainRequest(){if(l._usingXDomainRequest==null){var n=new XMLHttpRequest;typeof n.withCredentials>"u"&&typeof XDomainRequest<"u"?l._usingXDomainRequest=!0:l._usingXDomainRequest=!1}return l._usingXDomainRequest}static _createConnection(){var n=new XMLHttpRequest;return l.IsUsingXDomainRequest()?new XDomainRequest:n}static _DetectBrowser(){var n=navigator.userAgent.toLowerCase();(n.indexOf("safari")>=0||n.indexOf("firefox")>=0)&&n.indexOf("chrome")<0?l._isSafariOrFirefox=!0:l._isSafariOrFirefox=!1}}v(l,"_isSafariOrFirefox",null),v(l,"_usingXDomainRequest",null);var I=E(5298),L=E(515617);function R(g,n,s){return n in g?Object.defineProperty(g,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):g[n]=s,g}class V{WriteByte(n){this._buffer.push(L.wN.ToByte(n))}Write(n,s,a){for(;a--;)this.WriteByte(n[s++])}GetBuffer(){return this._buffer}constructor(){R(this,"_buffer",[])}}function H(g,n,s){return n in g?Object.defineProperty(g,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):g[n]=s,g}class K{WriteBlob(n){let s={type:"blob",value:n};this.data.push(s)}WriteBool(n){let s={type:"boolean",value:n};this.data.push(s)}WriteContainerBegin(n,s){let a={type:"containerBegin",size:n,elementType:s};this.data.push(a)}WriteMapContainerBegin(n,s,a){let d={type:"mapContainerBegin",size:n,keyType:s,valueType:a};this.data.push(d)}WriteContainerEnd(){let n={type:"containerEnd"};this.data.push(n)}WriteDouble(n){let s={type:"number",value:n};this.data.push(s)}WriteFloat(n){let s={type:"number",value:n};this.data.push(s)}WriteFieldBegin(n,s,a){let d={type:"fieldBegin",id:s};this.data.push(d)}WriteFieldEnd(){let n={type:"fieldEnd"};this.data.push(n)}WriteFieldOmitted(n,s,a){let d={type:"fieldOmitted",id:s};this.data.push(d)}WriteInt16(n){let s={type:"number",value:n};this.data.push(s)}WriteInt32(n){let s={type:"number",value:n};this.data.push(s)}WriteInt64(n){let s={type:"number",value:n.high*4294967296+n.low};this.data.push(s)}WriteInt8(n){let s={type:"number",value:n};this.data.push(s)}WriteString(n){let s={type:"string",value:n};this.data.push(s)}WriteStructBegin(n,s){let a={type:"structBegin",isBase:s};this.data.push(a)}WriteStructEnd(n){let s={type:"structEnd",isBase:n};this.data.push(s)}WriteUInt16(n){let s={type:"number",value:n};this.data.push(s)}WriteUInt32(n){let s={type:"number",value:n};this.data.push(s)}WriteUInt64(n){let s={type:"number",value:n};this.data.push(s)}WriteUInt8(n){let s={type:"number",value:n};this.data.push(s)}WriteWString(n){let s={type:"string",value:n};this.data.push(s)}constructor(){H(this,"data",[])}}function M(g,n,s){return n in g?Object.defineProperty(g,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):g[n]=s,g}var ee=function(g){return g[g.ECS_ERROR_OK=0]="ECS_ERROR_OK",g[g.ECS_ERROR_INVALID_STATUS=1]="ECS_ERROR_INVALID_STATUS",g[g.ECS_ERROR_INVALID_RESPONSE=6]="ECS_ERROR_INVALID_RESPONSE",g[g.ECS_ERROR_INVALID_CONFIG=8]="ECS_ERROR_INVALID_CONFIG",g}({});class _{ErrorCode(){return this._errorCode}toString(){switch(this._errorCode){case 0:return"ECS_ERROR_OK";case 1:return"ECS_ERROR_INVALID_STATUS";case 6:return"ECS_ERROR_INVALID_RESPONSE";case 8:return"ECS_ERROR_INVALID_CONFIG";default:return"Unknown error"}}constructor(n){M(this,"_errorCode",void 0),this._errorCode=n}}var c=function(g){return g[g.CONFIG_UPDATED=0]="CONFIG_UPDATED",g[g.TOKEN_IS_INVALID=1]="TOKEN_IS_INVALID",g}({});class b{Copy(n){if(this.uiVersion=n.uiVersion,this.log=n.log,this.servers=void 0,n.servers&&n.servers.length){this.servers=[];for(var s=0;s<n.servers.length;++s)this.servers.push(n.servers[s])}}constructor(){M(this,"uiVersion",void 0),M(this,"servers",void 0),M(this,"log",void 0)}}class F{static CreateEcsClient(){return new p}static __ChangeFailedRetryFactorInMS(n){S.FailedRetryFactorInMS=n}}class S{}M(S,"Servers",["https://config.teams.microsoft.com/config/v1/Skype/"]),M(S,"RefreshIntervalInMS",60*60*1e3),M(S,"FailedRetryFactorInMS",10*1e3),M(S,"MaxRetryIntervalForFailedInMS",60*60*1e3);var f=function(g){return g[g.Created=0]="Created",g[g.Initialized=1]="Initialized",g[g.Started=2]="Started",g[g.Loading=3]="Loading",g}(f||{});class p{Initialize(n){if(this._status!=0)throw new _(1);if(!n||!n.uiVersion)throw new _(8);this._config=new b,this._config.Copy(n),this._config.uiVersion=this._config.uiVersion.replace("/","_");var s=[];if(this._config.servers&&this._config.servers.length)s=this._config.servers;else for(var a=0;a<S.Servers.length;++a)s.push(S.Servers[a]);for(var d=[];s.length;){var C=Math.floor(Math.random()*s.length);d.push(s[C]),C==s.length-1?s.pop():s[C]=s.pop()}this._config.servers=d,this._Info("servers: "+this._config.servers.join(",")),this._status=1,this._Verbose("Initialize() done")}AddListener(n){this._Verbose("AddListener()"),this._CheckStatus(1);for(var s=0;s<this._listeners.length;++s)if(this._listeners[s]==n){this._Verbose("the listener has been added already, index: "+s);return}this._listeners.push(n)}RemoveListener(n){this._Verbose("RemoveListener()"),this._CheckStatus(1);for(var s=0;s<this._listeners.length;++s)if(this._listeners[s]==n){s==this._listeners.length-1?this._listeners.pop():this._listeners[s]=this._listeners.pop();return}}Start(){if(this._Verbose("Start()"),this._CheckStatus(1),this._status>=2){this._Verbose("Start() already, ignore");return}++this._tag,this._status=2,this.ConfigReloadAsync()}Stop(){if(this._Verbose("Stop()"),this._CheckStatus(1),this._status==1){this._Verbose("Stop() already, ignore");return}this._CleanTimer(),this._ecsConfig=null,this._etag=null,this._expireTime=null,this._failedTimes={},this._status=1}GetETag(){return this._CheckStatus(2),this._etag}SetSkypeToken(n){this._Verbose("SetToken()"),this._CheckStatus(2),n=n||null,this._status==3?(this._Verbose("A request is ongoing, postpone."),this._pendingToken.push(n)):(this._skypeToken=n,this.ConfigReloadAsync())}ConfigReloadAsync(){if(this._Verbose("ConfigReloadAsync()"),this._CheckStatus(2),this._status==3){this._Verbose("ConfigReloadAsync() is loading, ignore");return}this._CleanTimer();var n=this._tag,s=this._config.servers[0]+this._config.uiVersion,a={};for(var d in this._queryParams){a[d]={};for(var C in this._queryParams[d])a[d][C]=this._queryParams[d][C]}a.Headers={},!Utils.IsUsingXDomainRequest()&&this._etag&&(a.Headers["If-None-Match"]=this._etag),this._skypeToken&&(a.Headers.SkypeToken=this._skypeToken),Utils.keys(a.Headers).length==0&&delete a.Headers,Utils.ajax({type:"POST",url:s,data:JSON.stringify(a),complete:T=>this._HttpCallback(n,T)}),this._status=3}AddQueryParameter(n,s,a){if(s&&a){n||(n="global");var d=n.toLowerCase();if(d=="headers")return;d in this._queryParams||(this._queryParams[d]={}),this._queryParams[d][s.toLowerCase()]=a.toLowerCase()}}RemoveQueryParameter(n,s){var a="global";n&&(a=n.toLowerCase()),s&&(s=s.toLowerCase(),a in this._queryParams&&s in this._queryParams[a]&&(delete this._queryParams[a][s],Utils.keys(this._queryParams[a]).length==0&&delete this._queryParams[a]))}RemoveQueryParameterByNamespace(n){n?n=n.toLowerCase():n="global",delete this._queryParams[n]}GetSetting(n,s,a){return this._CheckStatus(2),n?this._GetSettingAsDefault(n,s,a,JSON.stringify):this._ecsConfig?JSON.stringify(this._ecsConfig):""}GetSettingAsString(n,s,a){return this._CheckStatus(2),this._GetSettingAsDefault(n,s,a,d=>""+d)}GetSettingAsInt(n,s,a){return this._CheckStatus(2),this._GetSettingAsDefault(n,s,a,parseInt)}GetSettingAsBool(n,s,a){return this._CheckStatus(2),this._GetSettingAsDefault(n,s,a,d=>!!d)}GetSettingAsReal(n,s,a){return this._CheckStatus(2),this._GetSettingAsDefault(n,s,a,parseFloat)}GetSettingAsList(n,s){return this._CheckStatus(2),this._GetSettingAsList(n,s,a=>""+a)}GetSettingAsListOfInts(n,s){return this._CheckStatus(2),this._GetSettingAsList(n,s,parseInt)}GetSettingAsListOfReal(n,s){return this._CheckStatus(2),this._GetSettingAsList(n,s,parseFloat)}GetKeys(n,s){if(this._CheckStatus(2),!n)return this.GetAgents();var a=this._NormalizePath(n,s);return a?this._GetObjectKeys(this._GetObject(a)):[]}GetAgents(){return this._CheckStatus(2),this._GetObjectKeys(this._ecsConfig)}_HttpCallback(n,s){if(this._Verbose("_HttpCallback"),this._status!=3||n!=this._tag){this._Verbose("_status != loading || tag != _tag, ignore");return}var a=!0,d=!1;try{if(s==null)throw this._Error("jqXHR is null. exception"),new _(6);var C=this._ParseResponse(s),T=C.statuscode;if(this._Info("status of HttpCallback: "+T),T>=200&&T<=299){var D=C.etag;if(this._Verbose("etag: "+D),!D)throw new _(6);var m=C.expires;this._Verbose("2xx: JSON.parse() success."),this._etag=D,this._ecsConfig=C.data,this._expireTime=C.expires,this._Notify(0)}else switch(T){case 304:this._Verbose("Config is not changed. Update expire time only."),this._expireTime=C.expires;break;case 401:this._Warning("token is invalid"),a=!1,this._Notify(1);break;case-1:a=!1;break;default:throw new _(6)}}catch(h){this._Error("exception: "+h),d=!0}a&&this._ScheduleTimer(d),this._status=2}_Notify(n){for(var s=0;s<this._listeners.length;++s)this._listeners[s](n)}_ScheduleTimer(n){if(this._CleanTimer(),n){var s=this._config.servers.shift();this._failedTimes[s]?++this._failedTimes[s]:this._failedTimes[s]=1,this._config.servers.push(s);var a=this._failedTimes[this._config.servers[0]]||0,d=0;a&&(d=Math.pow(2,a-1)*S.FailedRetryFactorInMS,d>S.MaxRetryIntervalForFailedInMS&&(d=S.MaxRetryIntervalForFailedInMS)),this._timer=setTimeout(()=>this.ConfigReloadAsync(),d)}else{this._failedTimes[this._config.servers[0]]=0;var C=!1;if(this._pendingToken.length){this._Verbose("Pending token found.");var T=this._pendingToken.pop();this._pendingToken.splice(0,this._pendingToken.length),T!=this._skypeToken&&(this._Verbose("Trigger new request immediately."),this._skypeToken=T,C=!0)}var d=0;C||(d=S.RefreshIntervalInMS,this._expireTime&&(d=this._expireTime-new Date().getTime(),d<0&&(d=0))),this._timer=setTimeout(()=>this.ConfigReloadAsync(),d)}}_CleanTimer(){this._timer&&(clearTimeout(this._timer),this._timer=null)}_GetSettingAsDefault(n,s,a,d){if(!n)return a;var C=this._NormalizePath(n,s);if(!C)return a;var T=this._GetObject(C);if(T==null)return a;try{return d(T)}catch{return a}}_GetSettingAsList(n,s,a){if(!n)return[];var d=this._NormalizePath(n,s);if(!d)return[];var C=this._GetObject(d);if(C==null)return[];try{for(var T=[],D=0;D<C.length;++D)T.push(a(C[D]));return T}catch{return[]}}_CheckStatus(n){if(this._status<n)throw this._Error(["status is error, current status:",this._status,"minimalStatus:",n].join(" ")),new _(1)}_GetObjectKeys(n){var s=[];if(n!=null)for(var a in n)s.push(a);return s}_GetObject(n){for(var s=n.split("/"),a=this._ecsConfig,d=0;d<s.length&&a;++d)a=a[s[d]];return a}_NormalizePath(n,s){return s!=null&&s.length&&s[0]=="/"&&(s=s.substr(1)),s!=null&&s.length&&s[s.length-1]=="/"&&(s=s.substr(0,s.length-1)),s?n?n+"/"+s:s:n}_Verbose(n){this._config&&this._config.log&&this._config.log.Verbose("[EcsClient]: "+n)}_Info(n){this._config&&this._config.log&&this._config.log.Info("[EcsClient]: "+n)}_Warning(n){this._config&&this._config.log&&this._config.log.Warning("[EcsClient]: "+n)}_Error(n){this._config&&this._config.log&&this._config.log.Error("[EcsClient]: "+n)}_ParseResponse(n){var s={};if(!n||typeof n.status>"u")this._Verbose("IE8/IE9 general error handler."),s.statuscode=-1;else if(n.status==304){var a=n.getResponseHeader("Expires");this._Verbose("expires: "+a),s.expires=a?Date.parse(a):null,s.etag=n.getResponseHeader("ETag"),s.statuscode=n.status}else if(n.status>=500)s.statuscode=n.status;else if(n.status==0)this._Verbose("Blocked by same-origin policy."),s.statuscode=-1;else try{s.statuscode=n.status;var d=JSON.parse(n.responseText),C=this._GetHeader(d);if(C){this._Verbose("Header found in body.");var a=C.expires;s.expires=a?Date.parse(a):null,s.statuscode=parseInt(C.statuscode),s.etag=C.etag}else this._Error("Header missing in response body.");s.data=d}catch{this._Error("Failed when parsing")}return this._Verbose("Return code = "+s.statuscode),s}_GetHeader(n){var s=null;for(var a in n)if(a.toLowerCase()=="headers"){s={};for(var d in n[a])s[d.toLowerCase()]=n[a][d];break}return s}__GetListenerArray(){return this._listeners}__UpdateServers(n){this._config.servers=n}__GetQueryParameters(){return this._queryParams}constructor(){M(this,"_tag",0),M(this,"_timer",void 0),M(this,"_expireTime",void 0),M(this,"_status",0),M(this,"_config",void 0),M(this,"_listeners",[]),M(this,"_etag",void 0),M(this,"_ecsConfig",void 0),M(this,"_failedTimes",{}),M(this,"_skypeToken",null),M(this,"_pendingToken",[]),M(this,"_queryParams",{})}}class G{static get version(){return"2.5.0"}}function N(g,n,s){return n in g?Object.defineProperty(g,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):g[n]=s,g}var me=function(g){return g[g.SENT=0]="SENT",g[g.SEND_FAILED=1]="SEND_FAILED",g}({}),_e=function(g){return g[g.DATARV_ERROR_OK=0]="DATARV_ERROR_OK",g[g.DATARV_ERROR_INVALID_EVENT=1]="DATARV_ERROR_INVALID_EVENT",g[g.DATARV_ERROR_INVALID_CONFIG=2]="DATARV_ERROR_INVALID_CONFIG",g[g.DATARV_ERROR_INVALID_DEPENDENCIES=3]="DATARV_ERROR_INVALID_DEPENDENCIES",g[g.DATARV_ERROR_INVALID_STATUS=4]="DATARV_ERROR_INVALID_STATUS",g[g.DATARV_ERROR_INVALID_ARG=5]="DATARV_ERROR_INVALID_ARG",g}({});class W{ErrorCode(){return this._errorCode}toString(){switch(this._errorCode){case 0:return"DATARV_ERROR_OK";case 1:return"Event is invalid. Either event.Id is empty, or event.Timestamp is empty, or event.EventType is empty.";case 2:return"Invalid configuration. CollectorUrl is missing.";case 3:return"DATARV_ERROR_INVALID_DEPENDENCIES";case 4:return"Telemetry Manager is not initialized.";case 5:return"TenantToken is null or empty, or events is null.";default:return"Unknown error"}}constructor(n){N(this,"_errorCode",0),this._errorCode=n}}class B{constructor(){N(this,"collectorUrl",void 0),N(this,"uiVersion",void 0),N(this,"log",void 0),N(this,"ecsClient",void 0),N(this,"useJsonTextStream",void 0),N(this,"overwriteSendTimeInterval",void 0),N(this,"eventsLimitInMem",1e4)}}class ie{static CreateTelemetryManager(){return new w}}class j{}N(j,"MaxPackageSizeInBytes",3*1e3*1e3),N(j,"TimeIntervalForNextSendInMS",15*1e3);var ge=function(g){return g[g.Created=0]="Created",g[g.Initialized=1]="Initialized",g[g.Started=2]="Started",g}(ge||{});class w{Initialize(n){if(this._status!=0)throw new W(4);if(!n||!n.collectorUrl)throw new W(2);this._config=n,this._Reset(),this._status=1,n.ecsClient&&(this._Verbose("ECS object assigned. Do integration"),this._ecsClient=n.ecsClient),n.overwriteSendTimeInterval&&n.overwriteSendTimeInterval>=0&&(j.TimeIntervalForNextSendInMS=n.overwriteSendTimeInterval),this._Verbose("Initialize() done")}setEventsLimitInMem(n){this._eventsCache.setEventsLimitInMem(n)}AddListener(n){if(this._status<1)throw new W(4);this._Verbose(["AddListener(), status: ",this._status," old length: ",this._listeners.length," func: ",n].join(""));for(var s=0;s<this._listeners.length;++s)if(this._listeners[s]==n){this._Verbose("the listener has been added already, index: "+s);return}this._listeners.push(n),this._Verbose("AddListener() done, the new length: "+this._listeners.length)}RemoveListener(n){if(this._status<1)throw new W(4);this._Verbose(["RemoveListener(), status: ",this._status," old length: ",this._listeners.length," func: ",n].join(""));for(var s=0;s<this._listeners.length;++s)if(this._listeners[s]==n){this._listeners.length==1?this._listeners=[]:s==this._listeners.length-1?this._listeners.pop():this._listeners[s]=this._listeners.pop(),this._Verbose(["this listener has been found, index: ",s,"new length: ",this._listeners.length].join(""));return}this._Verbose("listener isn't been found, new length"+this._listeners.length)}Start(){if(this._status<1)throw new W(4);this._Verbose(["Start(), status:",this._status,"tag:",w._tag].join(" ")),this._status>=2&&this._Verbose("Start() already, ignore"),this._ecsClient&&(this._ecsCallback=this._CreateEcsCallback(),this._ecsClient.AddListener(this._ecsCallback),this._etag=this._ecsClient.GetETag()),++w._tag,this._status=2,this._Verbose(["Start() done, status: ",this._status,"tag: ",w._tag].join(""))}Stop(){if(this._status<1)throw new W(4);if(this._Verbose("Stop(), status: "+this._status),this._status==1){this._Verbose("Stop() already, ignore");return}this._Reset(),this._status=1,this._Verbose("Stop() done, status: "+this._status)}Flush(n){this._eventsCache.IsEmpty()||this._WorkThread(n)}SendAsync(n,s){if(this._status<1)throw new W(4);if(this._Verbose(["SendAsync(), status:",this._status,"tenantToken:",n,"count:",s.length].join(" ")),this._status<2)return this._Info("SendAsync(), not started, ignore, return false"),!1;if(!n||!s)throw this._Error("SendAsync(), tenantToken or events is null or empty"),new W(5);for(var a=0;a<s.length;++a)if(!s[a].Id||!w._eventTypeRegex.test(s[a].EventType)||s[a].Timestamp.Equals("0"))throw this._Error(["eventId:",s[a].Id,"eventType:",s[a].EventType,"timestamp high:",s[a].Timestamp.high,"timestamp low:",s[a].Timestamp.low].join("")),new W(1);return this._eventsCache?.AddEvents(n,s),this._Verbose(["SendAsync(), currentTimer: ",this._timer,"eventsCacheIsEmpty",this._eventsCache.IsEmpty()].join(" ")),!this._eventsCache.IsEmpty()&&!this._timer&&this._ScheduleTimer(!1),this._Verbose("SendAsync() done"),!0}_WorkThread(n){try{var s=Date.now();if(this._Verbose("_WorkThread, status: "+this._status),this._status<2){this._Verbose("_WorkThread, status is not started, return");return}var a=this._eventsCache.DequeuEvents();if(a==null){this._Verbose("_WorkThread, No events found, return"),this._CleanTimer();return}var d=a.events.length,C=this._PackEvents(a.tenantToken,a.events);this._eventsCache?.AddEvents(a.tenantToken,C.remainedEvents);var T=C.remainedEvents.length;if(C.buffer==null||C.buffer.length==0){this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1));return}if(this._testHookListeners)for(var D=0;D<this._testHookListeners.length;++D)this._testHookListeners[D](C.sendEvents);if(this._testServerResponseHook){var m=this._testServerResponseHook();setTimeout(()=>this._SendCallback(te,a.tenantToken,C.sendEvents,m,null),100);return}var h={type:"POST",url:this._config.collectorUrl,processData:!1,headers:{"content-type":"application/bond-compact-binary","client-id":"NO_AUTH","sdk-version":"ACT-Web-JS-"+G.version},complete:ne=>this._SendCallback(te,a.tenantToken,C.sendEvents,ne,n)};this._config.useJsonTextStream?(h.data=C.buffer,h.headers["content-type"]="application/json"):l.IsSafariOrFirefox()||typeof Uint8Array>"u"?(this._Verbose("Uint8Array is undefined, send with base64 encode."),h.data=I.o4.GetString(C.buffer),h.headers["content-encoding"]="base64"):(this._Verbose("Uint8Array is defined, send with binary format directly."),h.data=new Uint8Array(C.buffer)),a.tenantToken&&(h.headers["x-apikey"]=a.tenantToken);var te=w._tag;this._lastActiveTime=new Date().getTime(),l.ajax(h),this._Verbose("_Workthread, send via jquery, tag: "+te),this._Info("Processing telemetry events took "+(Date.now()-s)+" ms for "+(d-T)+" events with total size of "+C.buffer.length+" bytes, remaining events - "+T)}catch(ne){this._Error("_WorkThread, exception: "+ne)}}_PackEvents(n,s){this._Verbose("_PackageEvents, total Count: "+s.length);var a=new O.D2,d=new O.LY;d.Source="JS_default_source",d.DataPackageId=O.Wp.GetGuid(),d.Timestamp=O.Wp.GetTimeStamp();var C,T=s;if(s=[],T.length>200){var D=T.splice(0,200);s.push.apply(s,T),T=D}for(;d.Records=[],d.Records.push.apply(d.Records,T),a.DataPackages=[],a.DataPackages.push(d),C=this._Serialize(a),this._Verbose(["_PackageEvents, sendEvents.length:",T.length," buffer.length:",C.length," MaxPackageSize:",this._MaxPackageSizeInBytes].join("")),!(C.length<this._MaxPackageSizeInBytes);){if(T.length==1){T=[],C=null;break}var m=T.splice(0,Math.floor(T.length/2));this._Verbose("_PackageEvents, too large, package again"),s.push.apply(s,T),T=m}return this._Verbose(["_PakcageEvents done, sendEventsCount:",T.length,"buffer.length:",C==null?0:C.length,"remained events:",s.length].join("")),{buffer:C,sendEvents:T,remainedEvents:s}}_Serialize(n){if(this._config.useJsonTextStream){var s=new K;return n.Write(s),JSON.stringify(s.data)}else{var a=new V,d=new L.E1(a);return n.Write(d),a.GetBuffer()}}_SendCallback(n,s,a,d,C){if(this._Verbose(["_SendCallback","tag:",n,"current tag:",w._tag,"tenantToken:",s,"events count:",a.length,"jqXHR:",d].join("")),C!=null){C(d?d.status:0,s,a);return}var T=d!=null&&d.status>=200&&d.status<300;if(this._status<2||n<w._tag){this._Verbose("_SendCallback, is not started, or tag is not the same, return");return}if(!T&&(!d||d.status!=400)){this._Verbose("retry statusCode: "+(d?d.status:0)),this._eventsCache?.AddEvents(s,a),this._ScheduleTimer(!0);return}for(var D=0;D<this._listeners.length;++D)this._listeners[D](T?0:1,d?d.status:0,s,a);this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1))}_CleanTimer(){this._Verbose("_CleanTimer(), timer: "+this._timer),this._timer&&(clearTimeout(this._timer),this._timer=null)}_ScheduleTimer(n){if(this._Verbose("_ScheduleTimer: isRetry: "+n),this._CleanTimer(),n){this._Verbose("_ScheduleTimer, current factor: "+this._rescheduleFactor);var s=Math.floor(5*this._rescheduleFactor*(1+Math.random()));this._timer=setTimeout(()=>this._WorkThread(null),s*1e3),this._Verbose("_ScheduleTimer, next try (s): "+s),this._rescheduleFactor<<=1,this._rescheduleFactor>64&&(this._rescheduleFactor=1)}else{var s=0,a=new Date().getTime(),d=a-this._lastActiveTime;d>j.TimeIntervalForNextSendInMS?s=0:s=j.TimeIntervalForNextSendInMS-d,this._timer=setTimeout(()=>this._WorkThread(null),s),this._Verbose("_ScheduleTimer, next try: "+s),this._rescheduleFactor=1}}_Verbose(n){this._config.log&&this._config.log.Verbose("[TelemetryManagerImpl]: "+n)}_Info(n){this._config.log&&this._config.log.Info("[TelemetryManagerImpl]: "+n)}_Error(n){this._config.log&&this._config.log.Error("[TelemetryManagerImpl]: "+n)}_Reset(){this._Verbose("Reset()"),this._CleanTimer(),this._lastActiveTime=0,this._rescheduleFactor=1,this._sendingEvents=[],this._eventsCache=new de(this._config.log,this._config.eventsLimitInMem),this._ecsClient&&(this._ecsClient.RemoveListener(this._ecsCallback),this._ecsCallback=null)}_CreateEcsCallback(){return n=>{n==c.CONFIG_UPDATED&&(this._etag=this._ecsClient.GetETag())}}__AddTestHookListener(n){if(this._status<1)throw new W(4);for(var s=0;s<this._testHookListeners.length;++s)if(this._testHookListeners[s]==n)return;this._testHookListeners.push(n)}__ClearTestHookListener(){this._testHookListeners=[]}__GetListenerArray(){return this._listeners}__GetTotalEventsCount(){return this._eventsCache.GetTotalEventsCount()}__IsScheduled(){return this._timer!=null}__ChageMaxPackageSizeInKB(n){this._MaxPackageSizeInBytes=n*1024}__SetTestServerResponseHook(n){this._testServerResponseHook=n}constructor(){N(this,"_MaxPackageSizeInBytes",j.MaxPackageSizeInBytes),N(this,"_lastActiveTime",void 0),N(this,"_rescheduleFactor",void 0),N(this,"_sendingEvents",void 0),N(this,"_eventsCache",void 0),N(this,"_timer",void 0),N(this,"_listeners",[]),N(this,"_status",0),N(this,"_config",void 0),N(this,"_ecsClient",null),N(this,"_etag",null),N(this,"_ecsCallback",null),N(this,"_testServerResponseHook",null),N(this,"_testHookListeners",[])}}N(w,"_eventTypeRegex",/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/),N(w,"_tag",0);class de{AddEvents(n,s){if(s.length){if(s.length>this._eventsLimitInMem){this._logDroppedEvents(n,s.length);return}this._events[n]||(this._events[n]=[],this._tokens.push(n)),this._events[n].push.apply(this._events[n],s)}}IsEmpty(){return this._tokens.length==0}DequeuEvents(){if(this._tokens.length==0)return null;var n=this._tokens.shift(),s=this._events[n];return delete this._events[n],{tenantToken:n,events:s}}GetTotalEventsCount(){var n=0;for(var s in this._events)n+=this._events[s].length;return n}setEventsLimitInMem(n){this._eventsLimitInMem=n}_logDroppedEvents(n,s){if(!this._logger)return;let a=0;this._events[n]&&(a=this._events[n].length),this._logger.Verbose(`[TelemetryEventCache]: Size of dropped events: ${s},
      events size currently in queue for tenant ${n}: ${a}`)}constructor(n,s){N(this,"_logger",void 0),N(this,"_eventsLimitInMem",void 0),N(this,"_events",void 0),N(this,"_tokens",void 0),this._logger=n,this._eventsLimitInMem=s,this._events={},this._tokens=[]}}}}]);

//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/535050-70b21df4c7bd941e.js.map